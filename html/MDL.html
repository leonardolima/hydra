<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory MDL</title>
</head>


<body>
<div class="head">
<h1>Theory MDL</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span> MDL
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Interval.html">Interval</a> <a href="Trace.html">Trace</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Formulas and Satisfiability›</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">typedef_overloaded</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> <span class="quoted">timestamp</span><span class="main">)</span> formula <span class="main">=</span> Bool <span class="quoted">bool</span> <span class="main">|</span> Atom <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">|</span> Neg <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula"</span></span> <span class="main">|</span>
  Bin <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula"</span></span> <span class="main">|</span>
  Prev <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> ℐ"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula"</span></span> <span class="main">|</span> Next <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> ℐ"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula"</span></span> <span class="main">|</span>
  Since <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> ℐ"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula"</span></span> <span class="main">|</span>
  Until <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> ℐ"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula"</span></span> <span class="main">|</span>
  MatchP <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> ℐ"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex"</span></span> <span class="main">|</span> MatchF <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> ℐ"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex <span class="main">=</span> Wild <span class="main">|</span> Test <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula"</span></span> <span class="main">|</span>
  Plus <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex"</span></span> <span class="main">|</span> Times <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex"</span></span> <span class="main">|</span>
  Star <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">FR_fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> timestamp<span class="main">)</span> formula <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">FR_regex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FR_fmla</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_fmla</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_fmla</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">FR_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_fmla</span> <span class="main">(</span>Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span><span class="free">FR_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">FR_fmla</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_fmla</span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">FR_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_fmla</span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> right <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">+</span> <span class="free">FR_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_fmla</span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span><span class="free">FR_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">FR_fmla</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_fmla</span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span> right <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">+</span> sup <span class="main">(</span><span class="free">FR_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">FR_fmla</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_fmla</span> <span class="main">(</span>MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">FR_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_fmla</span> <span class="main">(</span>MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> right <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">+</span> <span class="free">FR_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_regex</span> Wild <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_regex</span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">FR_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_regex</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span><span class="free">FR_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">FR_regex</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_regex</span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span><span class="free">FR_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">FR_regex</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FR_regex</span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">FR_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FR_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> timestamp<span class="main">)</span> formula"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> FR_fmla <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> FR_regex <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> right_I_add_mono' order.trans
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> FR_fmla_FR_regex.induct<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.coboundedI2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> sup.cobounded1<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> sup.coboundedI2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bounded_future_fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> timestamp<span class="main">)</span> formula <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">bounded_future_regex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bounded_future_fmla</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_fmla</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_fmla</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_fmla</span> <span class="main">(</span>Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">∧</span> <span class="free">bounded_future_fmla</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_fmla</span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_fmla</span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">∧</span> finite_ts <span class="main">(</span>right <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_fmla</span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">∧</span> <span class="free">bounded_future_fmla</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_fmla</span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">∧</span> <span class="free">bounded_future_fmla</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span> <span class="main">∧</span>
     finite_ts <span class="main">(</span>right <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_fmla</span> <span class="main">(</span>MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_fmla</span> <span class="main">(</span>MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> finite_ts <span class="main">(</span>right <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_regex</span> Wild <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_regex</span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_regex</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> <span class="free">bounded_future_regex</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_regex</span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> <span class="free">bounded_future_regex</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bounded_future_regex</span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">bounded_future_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> regex_induct<span class="main">[</span><span class="operator">case_names</span> Wild Test Plus Times Star<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword">type</span><span class="main"><span class="main">:</span></span> regex<span class="main">]</span> <span class="main">=</span>
  regex.induct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BTest</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> Test <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BaseF</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> Times <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> Wild"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BaseP</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> Times Wild <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PossiblyF</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PossiblyP</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Times <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Once</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> Since <span class="main">(</span>Bool True<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Historically</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> Neg <span class="main">(</span>Once <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Eventually</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> Until <span class="main">(</span>Bool True<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Always</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> Neg <span class="main">(</span>Eventually <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> MDL <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> timestamp<span class="main">)</span> trace"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> formula <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">match</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> Γ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> False <span class="main">|</span> Suc <span class="bound">j</span> <span class="main">⇒</span> mem <span class="main">(</span>τ <span class="free">σ</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="free">sat</span> <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem <span class="main">(</span>τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="free">sat</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> mem <span class="main">(</span>τ <span class="free">σ</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="free">sat</span> <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">j</span><span class="main">&lt;..</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span><span class="main">.</span> <span class="free">sat</span> <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> mem <span class="main">(</span>τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="bound">j</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="free">sat</span> <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">..&lt;</span><span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">sat</span> <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> mem <span class="main">(</span>τ <span class="free">σ</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">match</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> mem <span class="main">(</span>τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="bound">j</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="free">match</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">match</span> Wild <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">match</span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="free">sat</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">match</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">match</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∪</span> <span class="free">match</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">match</span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">match</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">O</span> <span class="free">match</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">match</span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> rtrancl <span class="main">(</span><span class="free">match</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prev_rewrite<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>Prev <span class="free">I</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> sat <span class="free">i</span> <span class="main">(</span>PossiblyP <span class="free">φ</span> <span class="free">I</span> Wild<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> j
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> next_rewrite<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>Next <span class="free">I</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> sat <span class="free">i</span> <span class="main">(</span>PossiblyF Wild <span class="free">I</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trancl_Base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">..&lt;</span><span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">..&lt;</span><span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Suc_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">..&lt;</span><span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> mem_Collect_eq prod.case Ball_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_Suc_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ball_atLeastLessThan_reindex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="free">j</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">j</span><span class="main">&lt;..</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_Suc_le less_eq_nat.simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> since_rewrite<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> sat <span class="free">i</span> <span class="main">(</span>PossiblyP <span class="free">ψ</span> <span class="free">I</span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"mem <span class="main">(</span>τ <span class="free">σ</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"sat <span class="skolem">j</span> <span class="free">ψ</span> "</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">j</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> sat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> match_BaseP<span class="main">:</span> <span class="quoted"><span class="quoted">"match <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">|</span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BaseP_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">j</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_def<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BaseP_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>match <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_def<span class="main">(</span>1<span class="main">)</span> trancl_Base
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> match_BaseP<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>PossiblyP <span class="free">ψ</span> <span class="free">I</span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>PossiblyP <span class="free">ψ</span> <span class="free">I</span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"mem <span class="main">(</span>τ <span class="free">σ</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>match <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="quoted"><span class="quoted">"sat <span class="skolem">j</span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> match_BaseP<span class="main">:</span> <span class="quoted"><span class="quoted">"match <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">|</span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BaseP_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">j</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_def<span class="main">(</span>3<span class="main">)</span> trancl_Base<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>BaseP <span class="free">φ</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> match_BaseP<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">j</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> sat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BaseP_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> Ball_atLeastLessThan_reindex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> sat <span class="bound">k</span> <span class="free">φ</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BaseP_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> until_rewrite<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>Until <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> sat <span class="free">i</span> <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>Until <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"mem <span class="main">(</span>τ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"sat <span class="skolem">j</span> <span class="free">ψ</span> "</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">..&lt;</span><span class="skolem">j</span><span class="main">}</span><span class="main">.</span> sat <span class="bound">k</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> match_BaseF<span class="main">:</span> <span class="quoted"><span class="quoted">"match <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">|</span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BaseF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">..&lt;</span><span class="skolem">j</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_def<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BaseF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>match <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_def<span class="main">(</span>1<span class="main">)</span> trancl_Base
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> match_BaseF<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"mem <span class="main">(</span>τ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>match <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="quoted"><span class="quoted">"sat <span class="skolem">j</span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> match_BaseF<span class="main">:</span> <span class="quoted"><span class="quoted">"match <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">|</span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BaseF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">..&lt;</span><span class="skolem">j</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_def<span class="main">(</span>3<span class="main">)</span> trancl_Base<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>BaseF <span class="free">φ</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> match_BaseF<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">..&lt;</span><span class="skolem">j</span><span class="main">}</span><span class="main">.</span> sat <span class="bound">k</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BaseF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">i</span> <span class="main">(</span>Until <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> match_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">∈</span> match <span class="free">r</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Star <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Star.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> match.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl.induct<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Star.IH<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> match_Times<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>Times <span class="free">r</span> <span class="free">s</span><span class="main">)</span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="free">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">k</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> match <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> match_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> le_iff_add nat_add_left_cancel_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rtrancl_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="main">∈</span> rtrancl <span class="free">R</span> <span class="main">⟹</span>
  <span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="main">∈</span> rtrancl <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> match_Star<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>Star <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="free">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">k</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>Star <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>Star <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> local.match <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="skolem">k</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>local.match <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rtrancl_unfold<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> match.simps<span class="main"><span class="main">]</span></span><span class="main">]</span> match_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> k_def<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>Star <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> match.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> match_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> k_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="skolem">k'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_Suc le_add_diff_inverse le_neq_implies_less<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="free">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">k</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>Star <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> k_def k_le <span class="keyword1"><span class="command">unfolding</span></span> k'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> match <span class="free">r</span> <span class="main">∧</span>
    <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">k</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>Star <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">i</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> match <span class="main">(</span>Star <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</body>

</html>