<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Monitor</title>
</head>


<body>
<div class="head">
<h1>Theory Monitor</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Monitor
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="MDL.html">MDL</a> <a href="Temporal.html">Temporal</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'h</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> time <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'h</span> <span class="main">×</span> <span class="tfree">'t</span><span class="main">)</span> option"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span>dead <span class="tfree">'a</span><span class="main">,</span> dead <span class="tfree">'t</span> <span class="main">::</span> <span class="quoted">timestamp</span><span class="main">,</span> dead <span class="tfree">'h</span><span class="main">)</span> vydra_rec <span class="main">=</span>
  VYDRA_Bool <span class="quoted">bool</span> <span class="tfree"><span class="quoted"><span class="tfree">'h</span></span></span>
  <span class="main">|</span> VYDRA_Atom <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="tfree"><span class="quoted"><span class="tfree">'h</span></span></span>
  <span class="main">|</span> VYDRA_Neg <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux"</span></span>
  <span class="main">|</span> VYDRA_Bin <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux"</span></span>
  <span class="main">|</span> VYDRA_MatchP <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> ℐ"</span></span> <span class="quoted"><span class="quoted">"transition iarray"</span></span> <span class="quoted">nat</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>bool iarray<span class="main">,</span> nat set<span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'h</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> time<span class="main">,</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux list<span class="main">)</span> window"</span></span>
  <span class="main">|</span> VYDRA_MatchF <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> ℐ"</span></span> <span class="quoted"><span class="quoted">"transition iarray"</span></span> <span class="quoted">nat</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>bool iarray<span class="main">,</span> nat set<span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'h</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> time<span class="main">,</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux list<span class="main">)</span> window"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux <span class="main">=</span> VYDRA <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_rec <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> bool<span class="main">)</span><span class="main">)</span> option"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">iarray_of_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> IArray <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">init_hd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">run_hd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'h</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'h</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">::</span> timestamp <span class="main">×</span> <span class="tfree">'a</span> set<span class="main">)</span><span class="main">)</span> option"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">t0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'h</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> time"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">t0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="main">(</span><span class="bound">e'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="bound">e'</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">run_t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'h</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> time <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'h</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> time <span class="main">×</span> <span class="tfree">'t</span><span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">run_t</span> None <span class="main">=</span> None"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run_t</span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">run_hd</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> Some <span class="main">(</span>None<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>
  <span class="main">|</span> Some <span class="main">(</span><span class="bound">e'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t'</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>Some <span class="main">(</span><span class="bound">e'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">read_t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'h</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> time <span class="main">⇒</span> <span class="tfree">'t</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">read_t</span> None <span class="main">=</span> None"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">read_t</span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> run_t_read<span class="main">:</span> <span class="quoted"><span class="quoted">"run_t <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">x'</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> read_t <span class="free">x</span> <span class="main">=</span> Some <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> read_t_run<span class="main">:</span> <span class="quoted"><span class="quoted">"read_t <span class="free">x</span> <span class="main">=</span> Some <span class="free">t</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x'</span><span class="main">.</span> run_t <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reach_event_t<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="free">e</span> <span class="free">vs</span> <span class="free">e''</span> <span class="main">⟹</span> <span class="free">run_hd</span> <span class="free">e</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">e'</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">run_hd</span> <span class="free">e''</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">e'''</span><span class="main">,</span> <span class="main">(</span><span class="free">t'</span><span class="main">,</span> <span class="free">X'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  reach_sub run_t <span class="main">(</span>Some <span class="main">(</span><span class="free">e'</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="free">e'''</span><span class="main">,</span> <span class="free">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">e''</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="free">X'</span></span> <span class="quoted"><span class="free">e'''</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_t</span></span> <span class="skolem"><span class="skolem">v_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v_t</span><span class="main">,</span> <span class="skolem">v_X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> run_t_s''<span class="main">:</span> <span class="quoted"><span class="quoted">"run_t <span class="main">(</span>Some <span class="main">(</span><span class="skolem">s''</span><span class="main">,</span> <span class="skolem">v_t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>Some <span class="main">(</span><span class="skolem">e'''</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">v_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> v_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> run_t_s''<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> v_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reach_event_t0_t<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="free">vs</span> <span class="free">e''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="free">e''</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">e'''</span><span class="main">,</span> <span class="main">(</span><span class="free">t'</span><span class="main">,</span> <span class="free">X'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reach_sub run_t t0 <span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="free">e'''</span><span class="main">,</span> <span class="free">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> t0_not_None<span class="main">:</span> <span class="quoted"><span class="quoted">"t0 <span class="main">≠</span> None"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> reach_sub.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t0_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_event_t<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t0_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">run_subs</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">vs'</span> <span class="main">=</span> map <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="bound">vs</span> <span class="keyword1">in</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> set <span class="bound">vs'</span><span class="main">.</span> Option.is_none <span class="bound">x</span><span class="main">)</span> <span class="keyword1">then</span> None
   <span class="keyword1">else</span> Some <span class="main">(</span>map <span class="main">(</span>fst <span class="main">∘</span> the<span class="main">)</span> <span class="bound">vs'</span><span class="main">,</span> iarray_of_list <span class="main">(</span>map <span class="main">(</span>snd <span class="main">∘</span> snd <span class="main">∘</span> the<span class="main">)</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> run_subs_lD<span class="main">:</span> <span class="quoted"><span class="quoted">"run_subs <span class="free">run</span> <span class="free">vs</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">vs'</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="main">⟹</span>
  length <span class="free">vs'</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> IArray.length <span class="free">bs</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> run_subs_def Let_def iarray_of_list_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> run_subs_vD<span class="main">:</span> <span class="quoted"><span class="quoted">"run_subs <span class="free">run</span> <span class="free">vs</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">vs'</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> length <span class="free">vs</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound">vj'</span> <span class="bound">tj</span> <span class="bound">bj</span><span class="main">.</span> <span class="free">run</span> <span class="main">(</span><span class="free">vs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">vj'</span><span class="main">,</span> <span class="main">(</span><span class="bound">tj</span><span class="main">,</span> <span class="bound">bj</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">vs'</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="bound">vj'</span> <span class="main">∧</span> IArray.sub <span class="free">bs</span> <span class="free">j</span> <span class="main">=</span> <span class="bound">bj</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="main">(</span><span class="free">vs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Option.is_none_def run_subs_def Let_def iarray_of_list_def
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_eqI nth_mem<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">read_subs</span> <span class="free"><span class="bound"><span class="entity">read</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">vs'</span> <span class="main">=</span> map <span class="free"><span class="bound"><span class="entity">read</span></span></span> <span class="bound">vs</span> <span class="keyword1">in</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> set <span class="bound">vs'</span><span class="main">.</span> Option.is_none <span class="bound">x</span><span class="main">)</span> <span class="keyword1">then</span> None
   <span class="keyword1">else</span> Some <span class="main">(</span>iarray_of_list <span class="main">(</span>map <span class="main">(</span>snd <span class="main">∘</span> the<span class="main">)</span> <span class="bound">vs'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> read_run_subs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> read_run<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">tb</span><span class="main">.</span> <span class="free">read</span> <span class="bound">s</span> <span class="main">=</span> Some <span class="bound">tb</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="free">run</span> <span class="bound">s</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">tb</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"read_subs <span class="free">read</span> <span class="free">s</span> <span class="main">=</span> Some <span class="free">tb</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> run_subs <span class="free">run</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="free">tb</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> run_None<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">run</span> <span class="bound">x</span> <span class="main">=</span> None <span class="main">⟹</span> <span class="free">read</span> <span class="bound">x</span> <span class="main">=</span> None"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
      <span class="keyword1"><span class="command">using</span></span> read_run<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">read</span> <span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assm
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> read_subs_def run_subs_def Let_def iarray_of_list_def
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
      <span class="keyword1"><span class="command">using</span></span> run_None<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
      <span class="keyword1"><span class="command">using</span></span> read_run<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">read</span> <span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> run_read_subs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> run_read<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">s'</span> <span class="bound">tb</span><span class="main">.</span> <span class="free">run</span> <span class="bound">s</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="bound">tb</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">read</span> <span class="bound">s</span> <span class="main">=</span> Some <span class="bound">tb</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"run_subs <span class="free">run</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">tb</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"read_subs <span class="free">read</span> <span class="free">s</span> <span class="main">=</span> Some <span class="free">tb</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> run_None<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">read</span> <span class="bound">x</span> <span class="main">=</span> None <span class="main">⟹</span> <span class="free">run</span> <span class="bound">x</span> <span class="main">=</span> None"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
      <span class="keyword1"><span class="command">using</span></span> run_read<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assm
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> read_subs_def run_subs_def Let_def iarray_of_list_def
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits option.splits if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
      <span class="keyword1"><span class="command">using</span></span> run_None<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
      <span class="keyword1"><span class="command">using</span></span> run_read<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">msize_fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> timestamp<span class="main">)</span> formula <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">msize_regex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">msize_fmla</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla</span> <span class="main">(</span>Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">+</span> <span class="free">msize_fmla</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla</span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla</span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla</span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>max <span class="main">(</span><span class="free">msize_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">msize_fmla</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla</span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>max <span class="main">(</span><span class="free">msize_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">msize_fmla</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla</span> <span class="main">(</span>MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla</span> <span class="main">(</span>MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_regex</span> Wild <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_regex</span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">msize_fmla</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_regex</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">msize_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">msize_regex</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_regex</span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">msize_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">msize_regex</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_regex</span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">msize_regex</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> collect_subfmlas_msize<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span>
  msize_fmla <span class="free">x</span> <span class="main">≤</span> msize_regex <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Wild
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Test <span class="skolem">phi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collect_subfmlas_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">r2</span></span> <span class="quoted"><span class="quoted">"collect_subfmlas <span class="skolem">r1</span> <span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collect_subfmlas_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">r2</span></span> <span class="quoted"><span class="quoted">"collect_subfmlas <span class="skolem">r1</span> <span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Star <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">msize_fmla'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">::</span> timestamp<span class="main">)</span> formula <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">msize_regex'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> regex <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">msize_fmla'</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla'</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla'</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_fmla'</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla'</span> <span class="main">(</span>Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_fmla'</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">+</span> <span class="free">msize_fmla'</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla'</span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">msize_fmla'</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla'</span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">msize_fmla'</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla'</span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span>
    Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">msize_fmla'</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">+</span> <span class="free">msize_fmla'</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla'</span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span>
    Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">msize_fmla'</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">+</span> <span class="free">msize_fmla'</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla'</span> <span class="main">(</span>MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_regex'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_fmla'</span> <span class="main">(</span>MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_regex'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_regex'</span> Wild <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_regex'</span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_fmla'</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_regex'</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_regex'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">+</span> <span class="free">msize_regex'</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_regex'</span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_regex'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">+</span> <span class="free">msize_regex'</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">msize_regex'</span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">msize_regex'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> collect_subfmlas_msize'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span>
  msize_fmla' <span class="free">x</span> <span class="main">&lt;</span> msize_regex' <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Wild
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Test <span class="skolem">phi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collect_subfmlas_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">r2</span></span> <span class="quoted"><span class="quoted">"collect_subfmlas <span class="skolem">r1</span> <span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> collect_subfmlas_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">r2</span></span> <span class="quoted"><span class="quoted">"collect_subfmlas <span class="skolem">r1</span> <span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Star <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">read</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> bool<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">read</span> <span class="main">(</span>VYDRA None<span class="main">)</span> <span class="main">=</span> None"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">read</span> <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">run</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> bool<span class="main">)</span><span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">run_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_rec <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_rec <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> bool<span class="main">)</span><span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>VYDRA None<span class="main">)</span> <span class="main">=</span> None"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>VYDRA <span class="main">(</span><span class="free">run_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>VYDRA_Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">run_hd</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None
    <span class="main">|</span> Some <span class="main">(</span><span class="bound">e'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>VYDRA_Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">e'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>VYDRA_Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">run_hd</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None
    <span class="main">|</span> Some <span class="main">(</span><span class="bound">e'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>VYDRA_Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">e'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run_rec</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>VYDRA_Neg <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">run</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None
    <span class="main">|</span> Some <span class="main">(</span><span class="bound">v'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>VYDRA_Neg <span class="bound">v'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="main">¬</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run_rec</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>VYDRA_Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="free"><span class="bound"><span class="entity">vr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">run</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">vl</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None
    <span class="main">|</span> Some <span class="main">(</span><span class="bound">vl'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">bl</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">run</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">vr</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None
    <span class="main">|</span> Some <span class="main">(</span><span class="bound">vr'</span><span class="main">,</span> <span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">br</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>VYDRA_Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">vl'</span> <span class="bound">vr'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">bl</span> <span class="bound">br</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run_rec</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>VYDRA_MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> eval_matchP <span class="main">(</span>init_args <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span> NFA.delta' <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span><span class="main">,</span> NFA.accept' <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span><span class="main">)</span>
      <span class="main">(</span>run_t<span class="main">,</span> read_t<span class="main">)</span> <span class="main">(</span>run_subs <span class="main">(</span><span class="free">run</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> read_subs read<span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None
    <span class="main">|</span> Some <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="bound">w'</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>VYDRA_MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span> <span class="bound">w'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run_rec</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>VYDRA_MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> eval_matchF <span class="main">(</span>init_args <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span> NFA.delta' <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span><span class="main">,</span> NFA.accept' <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span><span class="main">)</span>
      <span class="main">(</span>run_t<span class="main">,</span> read_t<span class="main">)</span> <span class="main">(</span>run_subs <span class="main">(</span><span class="free">run</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> read_subs read<span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None
    <span class="main">|</span> Some <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="bound">w'</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>VYDRA_MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span> <span class="bound">w'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">run_rec</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> None"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">run_vydra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> bool<span class="main">)</span><span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">run_vydra</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">⇒</span> map_option <span class="main">(</span>apfst <span class="main">(</span>Pair <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>run <span class="bound">n</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">m_sub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> formula<span class="main">)</span> <span class="main">+</span> <span class="main">(</span>nat <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> formula<span class="main">)</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">m_sub</span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> msize_fmla' <span class="free"><span class="bound"><span class="entity">phi</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">m_sub</span> <span class="main">(</span>Inr <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">*</span> msize_fmla' <span class="free"><span class="bound"><span class="entity">phi</span></span></span>"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">sub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">sub_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_rec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sub</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">=</span> VYDRA <span class="main">(</span>run_rec <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> VYDRA_Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free">init_hd</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> VYDRA_Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free">init_hd</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> VYDRA_Neg <span class="main">(</span><span class="free">sub</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span> VYDRA_Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free">sub</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">sub</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>PossiblyP <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> Wild<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>PossiblyF Wild <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>PossiblyP <span class="free"><span class="bound"><span class="entity">psi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">sub_rec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">qf</span> <span class="main">=</span> state_cnt <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span>
    <span class="bound">transs</span> <span class="main">=</span> iarray_of_list <span class="main">(</span>build_nfa_impl <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">qf</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
    VYDRA_MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">transs</span> <span class="bound">qf</span> <span class="main">(</span>init_window <span class="main">(</span>init_args
      <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span> NFA.delta' <span class="bound">transs</span> <span class="bound">qf</span><span class="main">,</span> NFA.accept' <span class="bound">transs</span> <span class="bound">qf</span><span class="main">)</span>
      <span class="main">(</span>run_t<span class="main">,</span> read_t<span class="main">)</span> <span class="main">(</span>run_subs <span class="main">(</span>run <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> read_subs read<span class="main">)</span><span class="main">)</span>
      t0 <span class="main">(</span>map <span class="main">(</span><span class="free">sub</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">qf</span> <span class="main">=</span> state_cnt <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span>
    <span class="bound">transs</span> <span class="main">=</span> iarray_of_list <span class="main">(</span>build_nfa_impl <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">qf</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
    VYDRA_MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">transs</span> <span class="bound">qf</span> <span class="main">(</span>init_window <span class="main">(</span>init_args
      <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span> NFA.delta' <span class="bound">transs</span> <span class="bound">qf</span><span class="main">,</span> NFA.accept' <span class="bound">transs</span> <span class="bound">qf</span><span class="main">)</span>
      <span class="main">(</span>run_t<span class="main">,</span> read_t<span class="main">)</span> <span class="main">(</span>run_subs <span class="main">(</span>run <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> read_subs read<span class="main">)</span><span class="main">)</span>
      t0 <span class="main">(</span>map <span class="main">(</span><span class="free">sub</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sub_rec</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> undefined"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure m_sub"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> collect_subfmlas_msize'
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def PossiblyF_def BaseP_def BaseF_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">init_vydra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">init_vydra</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span>msize_fmla <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">,</span> sub <span class="main">(</span>msize_fmla <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> run_read_Some<span class="main">:</span> <span class="quoted"><span class="quoted">"run <span class="free">n</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="free">tb</span><span class="main">)</span> <span class="main">⟹</span> read <span class="free">s</span> <span class="main">=</span> Some <span class="free">tb</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> run_read_None<span class="main">:</span> <span class="quoted"><span class="quoted">"run <span class="free">n</span> <span class="free">s</span> <span class="main">=</span> None <span class="main">⟹</span> read <span class="free">s</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> read_run_Some<span class="main">:</span> <span class="quoted"><span class="quoted">"read <span class="free">s</span> <span class="main">=</span> Some <span class="free">tb</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> run <span class="free">n</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">s'</span><span class="main">,</span> <span class="free">tb</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> read_run_None<span class="main">:</span> <span class="quoted"><span class="quoted">"read <span class="free">s</span> <span class="main">=</span> None <span class="main">⟹</span> run <span class="free">n</span> <span class="free">s</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> VYDRA_MDL <span class="main">=</span> MDL <span class="quoted"><span class="free">σ</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">σ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span> <span class="main">::</span> timestamp<span class="main">)</span> trace"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">init_hd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'h</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">run_hd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'h</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'h</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="tfree">'a</span> set<span class="main">)</span><span class="main">)</span> option"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> run_hd_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"reaches <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="free">n</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">run_hd</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free">n</span><span class="main">,</span> Γ <span class="free">σ</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reach_sub_run_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="free">es</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">run_hd</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">s'</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">(</span>length <span class="free">es</span><span class="main">)</span> <span class="main">∧</span> <span class="free">X</span> <span class="main">=</span> Γ <span class="free">σ</span> <span class="main">(</span>length <span class="free">es</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> run_hd_sound
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> reach_sub_n<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ru_t</span> <span class="main">≡</span> run_t <span class="free">run_hd</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">l_t0</span> <span class="main">≡</span> t0 <span class="free">init_hd</span> <span class="free">run_hd</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ru</span> <span class="main">≡</span> run <span class="free">run_hd</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">su</span> <span class="main">≡</span> sub <span class="free">init_hd</span> <span class="free">run_hd</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ru_t_event<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub ru_t <span class="free">t</span> <span class="free">ts</span> <span class="free">t'</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">=</span> l_t0 <span class="main">⟹</span> ru_t <span class="free">t'</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">t''</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound">rho</span> <span class="bound">e</span> <span class="bound">tt</span><span class="main">.</span> <span class="free">t'</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">e</span><span class="main">,</span> <span class="bound">tt</span><span class="main">)</span> <span class="main">∧</span> reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="bound">rho</span> <span class="bound">e</span> <span class="main">∧</span> length <span class="bound">rho</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">ts</span><span class="main">)</span> <span class="main">∧</span>
  <span class="free">x</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">(</span>length <span class="free">ts</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t''</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 reach_sub_run_hd<span class="main">[</span><span class="operator">OF</span> reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t0_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rho</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> rho_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">e</span><span class="main">,</span> <span class="skolem">tt</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="skolem">rho</span> <span class="skolem">e</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">rho</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">,</span>5<span class="main">)</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> rho_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> reach_sub_run_hd<span class="main">[</span><span class="operator">OF</span> rho_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ru_t_tau<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub ru_t l_t0 <span class="free">ts</span> <span class="free">t'</span> <span class="main">⟹</span> ru_t <span class="free">t'</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">t''</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">(</span>length <span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ru_t_event
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">wf_vydra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> trace <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span>
  <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span> <span class="main">::</span> timestamp<span class="main">,</span> <span class="tfree">'h</span><span class="main">)</span> vydra_aux <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_vydra</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span>VYDRA None<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">sub'</span></span></span> <span class="main">⟹</span> length <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">=</span> Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">=</span> sat <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span> <span class="free">wf_vydra</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
      <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">sub'</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">sub'</span></span></span> <span class="main">⟹</span> length <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">=</span> Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> sat <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span> <span class="free">wf_vydra</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
      <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">sub'</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_vydra</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free">σ</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> reach_sub <span class="main">(</span>ru <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>su <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> length <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> sat <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> msize_fmla <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">wf_vydra</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_Neg <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_vydra</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free">σ</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> <span class="free">wf_vydra</span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span> <span class="free">σ</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">⟹</span>
    reach_sub <span class="main">(</span>ru <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>su <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> length <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span>
    reach_sub <span class="main">(</span>ru <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>su <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">vs'</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">⟹</span> length <span class="free"><span class="bound"><span class="entity">vs'</span></span></span> <span class="main">=</span> Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> sat <span class="main">(</span>Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> msize_fmla <span class="main">(</span>Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">wf_vydra</span> <span class="main">(</span>Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_Bin <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"valid_window_matchP <span class="free"><span class="bound"><span class="entity">args</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> l_t0 <span class="main">(</span>map <span class="main">(</span>su <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> msize_regex <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span> <span class="main">=</span> state_cnt <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="main">=</span> iarray_of_list <span class="main">(</span>build_nfa_impl <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">args</span></span></span> <span class="main">=</span> init_args <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span> NFA.delta' <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span><span class="main">,</span> NFA.accept' <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span><span class="main">)</span>
      <span class="main">(</span>ru_t<span class="main">,</span> read_t<span class="main">)</span> <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> read_subs read<span class="main">)</span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> sat <span class="main">(</span>MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span>
    <span class="free">wf_vydra</span> <span class="main">(</span>MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_MatchP <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"valid_window_matchF <span class="free"><span class="bound"><span class="entity">args</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> l_t0 <span class="main">(</span>map <span class="main">(</span>su <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> msize_regex <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span> <span class="main">=</span> state_cnt <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="main">=</span> iarray_of_list <span class="main">(</span>build_nfa_impl <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">args</span></span></span> <span class="main">=</span> init_args <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span> NFA.delta' <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span><span class="main">,</span> NFA.accept' <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span><span class="main">)</span>
      <span class="main">(</span>ru_t<span class="main">,</span> read_t<span class="main">)</span> <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> read_subs read<span class="main">)</span> <span class="main">⟹</span>
    <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> τ <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> sat <span class="main">(</span>MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟹</span>
    <span class="free">wf_vydra</span> <span class="main">(</span>MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_MatchF <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">transs</span></span></span> <span class="free"><span class="bound"><span class="entity">qf</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_vydra</span> <span class="main">(</span>PossiblyP <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> Wild<span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> <span class="free">wf_vydra</span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_vydra</span> <span class="main">(</span>PossiblyF Wild <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> <span class="free">wf_vydra</span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_vydra</span> <span class="main">(</span>PossiblyP <span class="free"><span class="bound"><span class="entity">psi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> <span class="free">wf_vydra</span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_vydra</span> <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="free"><span class="bound"><span class="entity">phi</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> <span class="free">wf_vydra</span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">psi</span></span></span><span class="main">)</span> <span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> msize_fmla_transform<span class="main">:</span> <span class="quoted"><span class="quoted">"msize_fmla <span class="main">(</span>PossiblyP <span class="free">phi</span> <span class="free">I</span> Wild<span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>msize_fmla <span class="free">phi</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"msize_fmla <span class="main">(</span>PossiblyF Wild <span class="free">I</span> <span class="free">phi</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>msize_fmla <span class="free">phi</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"msize_fmla <span class="main">(</span>PossiblyP <span class="free">psi</span> <span class="free">I</span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="free">phi</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>max <span class="main">(</span>msize_fmla <span class="free">phi</span><span class="main">)</span> <span class="main">(</span>msize_fmla <span class="free">psi</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"msize_fmla <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="free">phi</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="free">psi</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>max <span class="main">(</span>msize_fmla <span class="free">phi</span><span class="main">)</span> <span class="main">(</span>msize_fmla <span class="free">psi</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def PossiblyF_def BaseP_def BaseF_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_vydraD<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_vydra <span class="free">φ</span> <span class="free">σ</span> <span class="free">i</span> <span class="free">n</span> <span class="free">v</span> <span class="main">⟹</span> ru <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">t</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> sat <span class="free">φ</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_vydra.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> prev_rewrite next_rewrite since_rewrite until_rewrite
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> msize_fmla_transform <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> reach_run_subs_len<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> reach_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>map <span class="main">(</span>su <span class="free">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="free">rho</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reach_subs run_subs_lD
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>su <span class="free">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">rho</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reach_run_subs_run<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> reach_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>map <span class="main">(</span>su <span class="free">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="free">rho</span> <span class="free">vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> subfmla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="main">=</span> collect_subfmlas <span class="free">r</span> <span class="main">[]</span> <span class="main">!</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">rho'</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="free">phi</span><span class="main">)</span> <span class="bound">rho'</span> <span class="main">(</span><span class="free">vs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">∧</span> length <span class="bound">rho'</span> <span class="main">=</span> length <span class="free">rho</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reach_subs subfmla
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>su <span class="free">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">rho</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs'</span> <span class="skolem">s''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> len_s'_vs <span class="main">=</span> reach_run_subs_len<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rho'</span></span> <span class="keyword2"><span class="keyword">where</span></span> reach_s'_vs<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="free">phi</span><span class="main">)</span> <span class="skolem">rho'</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">rho'</span> <span class="main">=</span> length <span class="skolem">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> run_subslD <span class="main">=</span> run_subs_lD<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> run_subsvD <span class="main">=</span> run_subs_vD<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> len_s'_vs<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vj'</span></span> <span class="skolem"><span class="skolem">tj</span></span> <span class="skolem"><span class="skolem">bj</span></span> <span class="keyword2"><span class="keyword">where</span></span> vj'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"ru <span class="free">n</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">vj'</span><span class="main">,</span> <span class="skolem">tj</span><span class="main">,</span> <span class="skolem">bj</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="skolem">vj'</span>"</span></span> <span class="quoted"><span class="quoted">"IArray.sub <span class="skolem">v</span> <span class="free">j</span> <span class="main">=</span> <span class="skolem">bj</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> run_subsvD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rho''</span></span> <span class="keyword2"><span class="keyword">where</span></span> rho''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="free">phi</span><span class="main">)</span> <span class="skolem">rho''</span> <span class="main">(</span><span class="skolem">s''</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">rho''</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">vs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> reach_s'_vs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> vj'_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> vj'_def<span class="main">(</span>2<span class="main">)</span> reach_s'_vs<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> conjunct1<span class="main">[</span><span class="operator">OF</span> run_subslD<span class="main">,</span> <span class="operator">unfolded</span> len_s'_vs<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> IArray_nth_equalityI<span class="main">:</span> <span class="quoted"><span class="quoted">"IArray.length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> IArray.length <span class="free">xs</span> <span class="main">⟹</span> IArray.sub <span class="free">xs</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">=</span> IArray <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> nth_equalityI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bs_sat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span> <span class="bound">v</span> <span class="bound">phi</span><span class="main">.</span> <span class="bound">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span>
    reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="bound">phi</span><span class="main">)</span> <span class="bound">vs</span> <span class="bound">v</span> <span class="main">⟹</span>
    bounded_future_fmla <span class="bound">phi</span> <span class="main">⟹</span> wf_vydra <span class="bound">phi</span> <span class="free">σ</span> <span class="main">(</span>length <span class="bound">vs</span><span class="main">)</span> <span class="free">n</span> <span class="bound">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> reach_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>map <span class="main">(</span>su <span class="free">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="free">rho</span> <span class="free">vs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> run_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">vs'</span><span class="main">,</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bf<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_future_regex <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">=</span> iarray_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">phi</span><span class="main">.</span> sat <span class="bound">phi</span> <span class="main">(</span>length <span class="free">rho</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span>
    IArray.sub <span class="free">bs</span> <span class="bound">j</span> <span class="main">=</span> sat <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>length <span class="free">rho</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> lassm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">phi</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">phi</span> <span class="main">=</span> collect_subfmlas <span class="free">r</span> <span class="main">[]</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> phi_in_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lassm
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> bf_phi<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="skolem">phi</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bf_collect_subfmlas<span class="main">[</span><span class="operator">OF</span> bf phi_in_set<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_vydra <span class="skolem">phi</span> <span class="free">σ</span> <span class="main">(</span>length <span class="free">rho</span><span class="main">)</span> <span class="free">n</span> <span class="main">(</span><span class="free">vs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IH<span class="main">[</span><span class="operator">OF</span> phi_in_set<span class="main">]</span> reach_run_subs_run IH<span class="main">[</span><span class="operator">OF</span> phi_in_set<span class="main">]</span> reach_subs lassm phi_def
        bf_phi
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"IArray.sub <span class="free">bs</span> <span class="skolem">j</span> <span class="main">=</span> sat <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>length <span class="free">rho</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> phi_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> wf_vydraD<span class="main">[</span><span class="operator">OF</span> wf<span class="main">]</span> run_subs_vD<span class="main">[</span><span class="operator">OF</span> run_subs<span class="main">,</span> <span class="operator">unfolded</span> reach_run_subs_len<span class="main"><span class="main">[</span></span><span class="operator">OF</span> reach_subs<span class="main"><span class="main">]</span></span><span class="main">,</span>
          <span class="operator">OF</span> lassm<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> conjunct2<span class="main">[</span><span class="operator">OF</span> run_subs_lD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> run_subs<span class="main"><span class="main">]</span></span><span class="main">]</span> reach_run_subs_len<span class="main">[</span><span class="operator">OF</span> reach_subs<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iarray_of_list_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> IArray_nth_equalityI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sub_induct_rec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">phi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> formula"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">b</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Bool <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Atom <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">phi</span><span class="main">.</span> msize_fmla <span class="bound">phi</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">phi</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Neg <span class="bound">phi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">f</span> <span class="bound">phi</span> <span class="bound">psi</span><span class="main">.</span> msize_fmla <span class="main">(</span>Bin <span class="bound">f</span> <span class="bound">phi</span> <span class="bound">psi</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="bound">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">phi</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">psi</span> <span class="main">⟹</span>
      <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Bin <span class="bound">f</span> <span class="bound">phi</span> <span class="bound">psi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">phi</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>PossiblyP <span class="bound">phi</span> <span class="bound">I</span> Wild<span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Prev <span class="bound">I</span> <span class="bound">phi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">phi</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>PossiblyF Wild <span class="bound">I</span> <span class="bound">phi</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Next <span class="bound">I</span> <span class="bound">phi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">phi</span> <span class="bound">psi</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>PossiblyP <span class="bound">psi</span> <span class="bound">I</span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="bound">phi</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Since <span class="bound">phi</span> <span class="bound">I</span> <span class="bound">psi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">phi</span> <span class="bound">psi</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="bound">phi</span><span class="main">)</span><span class="main">)</span> <span class="bound">I</span> <span class="bound">psi</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Until <span class="bound">phi</span> <span class="bound">I</span> <span class="bound">psi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">r</span><span class="main">.</span> msize_fmla <span class="main">(</span>MatchP <span class="bound">I</span> <span class="bound">r</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="bound">n</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="bound">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> msize_fmla <span class="bound">x</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>MatchP <span class="bound">I</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">r</span><span class="main">.</span> msize_fmla <span class="main">(</span>MatchF <span class="bound">I</span> <span class="bound">r</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="bound">n</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="bound">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> msize_fmla <span class="bound">x</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>MatchF <span class="bound">I</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> msize_fmla <span class="free">phi</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">n</span> <span class="free">phi</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sub_sub_rec.induct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> msize_fmla_transform<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> sub_induct<span class="main">[</span><span class="operator">case_names</span> Bool Atom Neg Bin Prev Next Since Until MatchP MatchF<span class="main">,</span> <span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">phi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'t</span><span class="main">)</span> formula"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"msize_fmla <span class="free">phi</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">b</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Bool <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Atom <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">phi</span><span class="main">.</span> msize_fmla <span class="bound">phi</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">phi</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Neg <span class="bound">phi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">f</span> <span class="bound">phi</span> <span class="bound">psi</span><span class="main">.</span> msize_fmla <span class="main">(</span>Bin <span class="bound">f</span> <span class="bound">phi</span> <span class="bound">psi</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="bound">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">phi</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">psi</span> <span class="main">⟹</span>
      <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Bin <span class="bound">f</span> <span class="bound">phi</span> <span class="bound">psi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">phi</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>PossiblyP <span class="bound">phi</span> <span class="bound">I</span> Wild<span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Prev <span class="bound">I</span> <span class="bound">phi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">phi</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>PossiblyF Wild <span class="bound">I</span> <span class="bound">phi</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Next <span class="bound">I</span> <span class="bound">phi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">phi</span> <span class="bound">psi</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>PossiblyP <span class="bound">psi</span> <span class="bound">I</span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="bound">phi</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Since <span class="bound">phi</span> <span class="bound">I</span> <span class="bound">psi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">phi</span> <span class="bound">psi</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="bound">phi</span><span class="main">)</span><span class="main">)</span> <span class="bound">I</span> <span class="bound">psi</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">(</span>Until <span class="bound">phi</span> <span class="bound">I</span> <span class="bound">psi</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">r</span><span class="main">.</span> msize_fmla <span class="main">(</span>MatchP <span class="bound">I</span> <span class="bound">r</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="bound">n</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="bound">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> msize_fmla <span class="bound">x</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>MatchP <span class="bound">I</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">I</span> <span class="bound">r</span><span class="main">.</span> msize_fmla <span class="main">(</span>MatchF <span class="bound">I</span> <span class="bound">r</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="bound">n</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="bound">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> msize_fmla <span class="bound">x</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>MatchF <span class="bound">I</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">n</span> <span class="free">phi</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sub_induct_rec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">phi</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vydra_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msize_fmla <span class="free">φ</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="free">φ</span><span class="main">)</span> <span class="free">vs</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf_vydra <span class="free">φ</span> <span class="free">σ</span> <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sub_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bool <span class="skolem">b</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> run_event_init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">init'</span> <span class="bound">t</span> <span class="bound">X</span><span class="main">.</span> <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">init'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="main">[</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">]</span> <span class="bound">init'</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">=</span> Γ <span class="free">σ</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_sub_run_hd
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Bool
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"su <span class="skolem">n</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_event_init
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">es</span> <span class="bound">re</span> <span class="bound">re'</span> <span class="bound">t</span> <span class="bound">X</span><span class="main">.</span> reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="bound">es</span> <span class="bound">re</span> <span class="main">⟹</span> <span class="free">run_hd</span> <span class="bound">re</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">re'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="bound">t</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">(</span>length <span class="bound">es</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_run_hd
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 reach_sub_app<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> reach_sub.cases <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.cases
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> run_event_init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">init'</span> <span class="bound">t</span> <span class="bound">X</span><span class="main">.</span> <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">init'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="main">[</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">]</span> <span class="bound">init'</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">=</span> Γ <span class="free">σ</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_sub_run_hd
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Atom
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"su <span class="skolem">n</span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> run_event_init
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">es</span> <span class="bound">re</span> <span class="bound">re'</span> <span class="bound">t</span> <span class="bound">X</span><span class="main">.</span> reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="bound">es</span> <span class="bound">re</span> <span class="main">⟹</span> <span class="free">run_hd</span> <span class="bound">re</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">re'</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="bound">t</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">(</span>length <span class="bound">es</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">=</span> Γ <span class="free">σ</span> <span class="main">(</span>length <span class="bound">es</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_run_hd
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 reach_sub_app<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> reach_sub.cases <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.cases
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bf<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Neg<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">vs</span> <span class="skolem">v</span> <span class="main">⟹</span>
    wf_vydra <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Neg<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">OF</span> _ bf<span class="main">]</span> Neg<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a t b
        <span class="keyword1"><span class="command">using</span></span> wf_vydraD<span class="main">[</span><span class="operator">OF</span> Neg<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bf<span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ reach_sub.intros<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">vs'</span> <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs'</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"wf_vydra <span class="skolem">x</span> <span class="free">σ</span> <span class="main">(</span>length <span class="skolem">vs'</span><span class="main">)</span> <span class="skolem">n</span> <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> msize_fmla <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_Neg <span class="skolem">v'</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> s''_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span> <span class="bound">t</span> <span class="bound">b</span><span class="main">.</span> <span class="skolem">s''</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_Neg <span class="bound">w</span><span class="main">,</span> <span class="bound">t</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="bound">t</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> sat <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">t</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> lassm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_Neg <span class="skolem">w</span><span class="main">,</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> run_v'<span class="main">:</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">v'</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="main">¬</span><span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> vs'_def lassm
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> sat <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> wf_vydraD<span class="main">[</span><span class="operator">OF</span> vs'_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> run_v'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> vs'_def<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> wf_vydra_s''<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_vydra <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span> <span class="free">σ</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">s''</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> vs'_def<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> vs'_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
        Neg<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reach_sub_app<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> reach_sub_app<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span><span class="main">]</span> s''_sound bf
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">≠</span> VYDRA None <span class="main">⟹</span>
      <span class="main">∃</span><span class="bound">vs'</span> <span class="bound">v'</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="bound">vs'</span> <span class="bound">v'</span> <span class="main">∧</span> length <span class="bound">vs'</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wf_vydra_s''
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vs'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Neg
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bin <span class="skolem">n</span> <span class="skolem">f</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Bin <span class="skolem">f</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">vs</span> <span class="skolem">v</span> <span class="main">⟹</span>
    wf_vydra <span class="main">(</span>Bin <span class="skolem">f</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span> <span class="free">σ</span> <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Bin <span class="skolem">f</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Bin<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        Bin<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a t b a' t' b'
        <span class="keyword1"><span class="command">using</span></span> wf_vydraD<span class="main">[</span><span class="operator">OF</span> Bin<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
          wf_vydraD<span class="main">[</span><span class="operator">OF</span> Bin<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> Bin<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reach_sub.intros wf_vydra.intros<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> wf_vydra <span class="main">=</span> 2<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x1</span><span class="main">)</span> <span class="skolem">vs1</span> <span class="skolem">v1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs1</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"wf_vydra <span class="skolem">x1</span> <span class="free">σ</span> <span class="main">(</span>length <span class="skolem">vs1</span><span class="main">)</span> <span class="skolem">n</span> <span class="skolem">v1</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x2</span><span class="main">)</span> <span class="skolem">vs2</span> <span class="skolem">v2</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs2</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"wf_vydra <span class="skolem">x2</span> <span class="free">σ</span> <span class="main">(</span>length <span class="skolem">vs2</span><span class="main">)</span> <span class="skolem">n</span> <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> s'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_Bin <span class="skolem">f</span> <span class="skolem">v1</span> <span class="skolem">v2</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_vydra<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> vs1_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> vs2_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> vs1_def<span class="main">(</span>2<span class="main">)</span> vs2_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> wf_vydra.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> s''_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span> <span class="bound">w2</span> <span class="bound">t</span> <span class="bound">b</span><span class="main">.</span> <span class="skolem">s''</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_Bin <span class="skolem">f</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">,</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="bound">t</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> sat <span class="main">(</span>Bin <span class="skolem">f</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w1</span> <span class="skolem">w2</span> <span class="skolem">t</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> lassm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_Bin <span class="skolem">f</span> <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">,</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> run_v1<span class="main">:</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">v1</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">w1</span><span class="main">,</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">b1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> s'_def lassm
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> run_v2<span class="main">:</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">v2</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">w2</span><span class="main">,</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> wf_vydraD<span class="main">[</span><span class="operator">OF</span> vs1_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> wf_vydraD<span class="main">[</span><span class="operator">OF</span> vs2_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
          vs1_def<span class="main">(</span>2<span class="main">)</span> vs2_def<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> s'_def lassm
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> τ <span class="free">σ</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> sat <span class="main">(</span>Bin <span class="skolem">f</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> wf_vydraD<span class="main">[</span><span class="operator">OF</span> vs1_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> run_v1<span class="main">]</span> wf_vydraD<span class="main">[</span><span class="operator">OF</span> vs2_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> run_v2<span class="main">]</span>
          2<span class="main">(</span>3<span class="main">)</span> run_v1 run_v2
        <span class="keyword1"><span class="command">unfolding</span></span> vs1_def<span class="main">(</span>2<span class="main">)</span> vs2_def<span class="main">(</span>2<span class="main">)</span> s'_def lassm
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> wf_vydra_s''<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_vydra <span class="main">(</span>Bin <span class="skolem">f</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span> <span class="free">σ</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">s''</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wf_vydra
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> Bin<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reach_sub_app<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> Bin<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reach_sub_app<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        reach_sub_app<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span><span class="main">]</span> s''_sound Bin<span class="main">(</span>5<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> s'_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits prod.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">≠</span> VYDRA None <span class="main">⟹</span>
      <span class="main">∃</span><span class="bound">vs1</span> <span class="bound">v1</span> <span class="bound">vs2</span> <span class="bound">v2</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x1</span><span class="main">)</span> <span class="bound">vs1</span> <span class="bound">v1</span> <span class="main">∧</span> reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x2</span><span class="main">)</span> <span class="bound">vs2</span> <span class="bound">v2</span> <span class="main">∧</span>
      length <span class="bound">vs1</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> length <span class="bound">vs2</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wf_vydra_s''
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Bin<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MatchP <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> msize_regex<span class="main">:</span> <span class="quoted"><span class="quoted">"msize_regex <span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchP<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bf<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_future_regex <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchP<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> msize_fmla <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_trans<span class="main">[</span><span class="operator">OF</span> collect_subfmlas_msize<span class="main">]</span> MatchP<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span> <span class="bound">v</span> <span class="bound">phi</span><span class="main">.</span> <span class="bound">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span>
    reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="bound">phi</span><span class="main">)</span> <span class="bound">vs</span> <span class="bound">v</span> <span class="main">⟹</span> bounded_future_fmla <span class="bound">phi</span> <span class="main">⟹</span>
    wf_vydra <span class="bound">phi</span> <span class="free">σ</span> <span class="main">(</span>length <span class="bound">vs</span><span class="main">)</span> <span class="skolem">n</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchP<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">args</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">args</span> <span class="main">=</span> <span class="main">(</span>init_args <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span>
    NFA.delta' <span class="main">(</span>iarray_of_list <span class="main">(</span>build_nfa_impl <span class="skolem">r</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> state_cnt <span class="skolem">r</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>state_cnt <span class="skolem">r</span><span class="main">)</span><span class="main">,</span>
    NFA.accept' <span class="main">(</span>iarray_of_list <span class="main">(</span>build_nfa_impl <span class="skolem">r</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> state_cnt <span class="skolem">r</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>state_cnt <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>ru_t<span class="main">,</span> read_t<span class="main">)</span> <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">,</span> read_subs read<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> MDL_window <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted">l_t0</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">args</span></span>
    <span class="keyword1"><span class="command">using</span></span> bs_sat<span class="main">[</span><span class="operator">OF</span> IH<span class="main">]</span> run_read_subs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span> <span class="quoted">read</span><span class="main">]</span> read_run_subs<span class="main">[</span><span class="operator">of</span> <span class="quoted">read</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span><span class="main">]</span>
      run_read_Some<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> read_run_Some<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> run_t_read<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span>
      read_t_run<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> ru_t_tau bf
    <span class="keyword1"><span class="command">unfolding</span></span> args_def iarray_of_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l_sub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l_sub</span> <span class="main">=</span> map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> args' <span class="main">=</span> args_def<span class="main">[</span><span class="operator">unfolded</span> init_args.simps<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>MatchP <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">vs</span> <span class="skolem">v</span> <span class="main">⟹</span>
    wf_vydra <span class="main">(</span>MatchP <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span> <span class="free">σ</span> <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>MatchP <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> init_window <span class="skolem">args</span> l_t0 <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> w_def' <span class="main">=</span> w_def<span class="main">[</span><span class="operator">unfolded</span> init_window.simps init_def<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eval_mP <span class="skolem">I</span> <span class="skolem">w</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args' w_def' Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tj'</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">sj'</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> somes<span class="main">:</span> <span class="quoted"><span class="quoted">"w_run_t <span class="skolem">args</span> <span class="main">(</span>w_tj <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">tj'</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"w_run_sub <span class="skolem">args</span> <span class="main">(</span>w_sj <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">sj'</span><span class="main">,</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Some read_t_run read_sub_run
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_mP <span class="skolem">I</span> <span class="skolem">w</span> <span class="main">=</span> Some <span class="main">(</span><span class="main">(</span>τ <span class="free">σ</span> <span class="main">0</span><span class="main">,</span> sat <span class="main">(</span>MatchP <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="skolem">w'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"valid_matchP <span class="skolem">I</span> l_t0 <span class="skolem">l_sub</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">bs</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">w'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_eval_matchP<span class="main">[</span><span class="operator">OF</span> valid_init_matchP<span class="main"><span class="main">[</span></span><span class="operator">folded</span> w_def<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">unfolded</span> somes<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> l_sub_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> w'_def msize_regex
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args' w_def' l_sub_def Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_t</span></span> <span class="skolem"><span class="skolem">v_b</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v_t</span><span class="main">,</span> <span class="skolem">v_b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> s'_def<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_MatchP <span class="skolem">I</span> <span class="main">(</span>iarray_of_list transs<span class="main">)</span> qf <span class="skolem">w</span><span class="main">,</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qf_def transs_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> wf_vydra.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> valid_window<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_matchP <span class="skolem">I</span> l_t0 <span class="skolem">l_sub</span> <span class="skolem">xs</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> s'_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args' l_sub_def s'_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eval_mP <span class="skolem">I</span> <span class="skolem">w</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> s'_def<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> transs_def qf_def args' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tj'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">sj'</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> somes<span class="main">:</span> <span class="quoted"><span class="quoted">"w_run_t <span class="skolem">args</span> <span class="main">(</span>w_tj <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">tj'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"w_run_sub <span class="skolem">args</span> <span class="main">(</span>w_sj <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">sj'</span><span class="main">,</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Some read_t_run read_sub_run
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_mP <span class="skolem">I</span> <span class="skolem">w</span> <span class="main">=</span> Some <span class="main">(</span><span class="main">(</span>τ <span class="free">σ</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
        sat <span class="main">(</span>MatchP <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">w'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"valid_matchP <span class="skolem">I</span> l_t0 <span class="skolem">l_sub</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t'</span><span class="main">,</span> <span class="skolem">bs</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_eval_matchP<span class="main">[</span><span class="operator">folded</span> l_sub_def<span class="main">,</span> <span class="operator">OF</span> valid_window<span class="main">,</span> <span class="operator">unfolded</span> somes<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> s''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_MatchP <span class="skolem">I</span> <span class="main">(</span>iarray_of_list transs<span class="main">)</span> qf <span class="skolem">w'</span><span class="main">,</span>
        <span class="main">(</span>τ <span class="free">σ</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> sat <span class="main">(</span>MatchP <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> s'_def<span class="main">]</span> w'_def<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> transs_def qf_def args'<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> s''_def
        <span class="keyword1"><span class="command">using</span></span> w'_def<span class="main">(</span>2<span class="main">)</span> msize_regex
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> eval_matchP.simps <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qf_def transs_def l_sub_def args'
            <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchP<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MatchF <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> msize_regex<span class="main">:</span> <span class="quoted"><span class="quoted">"msize_regex <span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchF<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bf<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_future_regex <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"finite_ts <span class="main">(</span>right <span class="skolem">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchF<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> msize_fmla <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_trans<span class="main">[</span><span class="operator">OF</span> collect_subfmlas_msize<span class="main">]</span> MatchF<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">vs</span> <span class="bound">v</span> <span class="bound">phi</span><span class="main">.</span> <span class="bound">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span>
    reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="bound">phi</span><span class="main">)</span> <span class="bound">vs</span> <span class="bound">v</span> <span class="main">⟹</span> bounded_future_fmla <span class="bound">phi</span> <span class="main">⟹</span>
    wf_vydra <span class="bound">phi</span> <span class="free">σ</span> <span class="main">(</span>length <span class="bound">vs</span><span class="main">)</span> <span class="skolem">n</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchF<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">args</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">args</span> <span class="main">=</span> <span class="main">(</span>init_args <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span>
    NFA.delta' <span class="main">(</span>iarray_of_list <span class="main">(</span>build_nfa_impl <span class="skolem">r</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> state_cnt <span class="skolem">r</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>state_cnt <span class="skolem">r</span><span class="main">)</span><span class="main">,</span>
    NFA.accept' <span class="main">(</span>iarray_of_list <span class="main">(</span>build_nfa_impl <span class="skolem">r</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> state_cnt <span class="skolem">r</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>state_cnt <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>ru_t<span class="main">,</span> read_t<span class="main">)</span> <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">,</span> read_subs read<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> MDL_window <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted">l_t0</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">args</span></span>
    <span class="keyword1"><span class="command">using</span></span> bs_sat<span class="main">[</span><span class="operator">OF</span> IH<span class="main">]</span> run_read_subs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span> <span class="quoted">read</span><span class="main">]</span> read_run_subs<span class="main">[</span><span class="operator">of</span> <span class="quoted">read</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span><span class="main">]</span>
      run_read_Some<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> read_run_Some<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> run_t_read<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span>
      read_t_run<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> ru_t_tau bf
    <span class="keyword1"><span class="command">unfolding</span></span> args_def iarray_of_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l_sub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l_sub</span> <span class="main">=</span> map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> args' <span class="main">=</span> args_def<span class="main">[</span><span class="operator">unfolded</span> init_args.simps<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>MatchF <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">vs</span> <span class="skolem">v</span> <span class="main">⟹</span>
    wf_vydra <span class="main">(</span>MatchF <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span> <span class="free">σ</span> <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>MatchF <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> init_window <span class="skolem">args</span> l_t0 <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> w_def' <span class="main">=</span> w_def<span class="main">[</span><span class="operator">unfolded</span> init_window.simps init_def<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eval_mF <span class="skolem">I</span> <span class="skolem">w</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args' w_def' Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="skolem"><span class="skolem">rho'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_mF <span class="skolem">I</span> <span class="skolem">w</span> <span class="main">=</span> Some <span class="main">(</span><span class="main">(</span>τ <span class="free">σ</span> <span class="main">0</span><span class="main">,</span> sat <span class="main">(</span>MatchF <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="skolem">w'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"valid_matchF <span class="skolem">I</span> l_t0 <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rho'</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">w'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_eval_matchF_sound<span class="main">[</span><span class="operator">OF</span> valid_init_matchF<span class="main"><span class="main">[</span></span><span class="operator">folded</span> w_def<span class="main"><span class="main">]</span></span> _ bf<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> Some
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> eval_matchF.simps<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> w'_def msize_regex
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args' w_def' l_sub_def Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_t</span></span> <span class="skolem"><span class="skolem">v_b</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v_t</span><span class="main">,</span> <span class="skolem">v_b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> s'_def<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_MatchF <span class="skolem">I</span> <span class="main">(</span>iarray_of_list transs<span class="main">)</span> qf <span class="skolem">w</span><span class="main">,</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qf_def transs_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> wf_vydra.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> valid_window<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_matchF <span class="skolem">I</span> l_t0 <span class="skolem">l_sub</span> <span class="skolem">xs</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> s'_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args' l_sub_def s'_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eval_mF <span class="skolem">I</span> <span class="skolem">w</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> s'_def<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> transs_def qf_def args' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="skolem"><span class="skolem">rho'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_mF <span class="skolem">I</span> <span class="skolem">w</span> <span class="main">=</span> Some <span class="main">(</span><span class="main">(</span>τ <span class="free">σ</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
        sat <span class="main">(</span>MatchF <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">w'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"valid_matchF <span class="skolem">I</span> l_t0 <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rho'</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_eval_matchF_sound<span class="main">[</span><span class="operator">OF</span> valid_window<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> l_sub_def<span class="main"><span class="main">]</span></span> _ bf<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> Some
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> eval_matchF.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> s''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_MatchF <span class="skolem">I</span> <span class="main">(</span>iarray_of_list transs<span class="main">)</span> qf <span class="skolem">w'</span><span class="main">,</span>
        <span class="main">(</span>τ <span class="free">σ</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> sat <span class="main">(</span>MatchF <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> s'_def<span class="main">]</span> w'_def<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> transs_def qf_def args'<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> s''_def
        <span class="keyword1"><span class="command">using</span></span> w'_def<span class="main">(</span>2<span class="main">)</span> msize_regex
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> eval_matchP.simps <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qf_def transs_def l_sub_def args'
            <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchF<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Prev <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sub_prev<span class="main">:</span> <span class="quoted"><span class="quoted">"su <span class="skolem">n</span> <span class="main">(</span>Prev <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span> <span class="main">=</span> su <span class="skolem">n</span> <span class="main">(</span>PossiblyP <span class="skolem">phi</span> <span class="skolem">I</span> Wild<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Prev<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Prev<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> sub_prev<span class="main"><span class="main">]</span></span><span class="main">]</span> Prev<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sub_next<span class="main">:</span> <span class="quoted"><span class="quoted">"su <span class="skolem">n</span> <span class="main">(</span>Next <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span> <span class="main">=</span> su <span class="skolem">n</span> <span class="main">(</span>PossiblyF Wild <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Next<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Next<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> sub_next<span class="main"><span class="main">]</span></span><span class="main">]</span> Next<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Since <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">phi</span> <span class="skolem">psi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sub_since<span class="main">:</span> <span class="quoted"><span class="quoted">"su <span class="skolem">n</span> <span class="main">(</span>Since <span class="skolem">phi</span> <span class="skolem">I</span> <span class="skolem">psi</span><span class="main">)</span> <span class="main">=</span> su <span class="skolem">n</span> <span class="main">(</span>PossiblyP <span class="skolem">psi</span> <span class="skolem">I</span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="skolem">phi</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def BaseP_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Since<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Since<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> sub_since<span class="main"><span class="main">]</span></span><span class="main">]</span> Since<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def BaseP_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">phi</span> <span class="skolem">psi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sub_until<span class="main">:</span> <span class="quoted"><span class="quoted">"su <span class="skolem">n</span> <span class="main">(</span>Until <span class="skolem">phi</span> <span class="skolem">I</span> <span class="skolem">psi</span><span class="main">)</span> <span class="main">=</span> su <span class="skolem">n</span> <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="skolem">phi</span><span class="main">)</span><span class="main">)</span> <span class="skolem">I</span> <span class="skolem">psi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def BaseF_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Until<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Until<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> sub_until<span class="main"><span class="main">]</span></span><span class="main">]</span> Until<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def BaseF_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_vydra.intros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reach_subs_run_lD<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">vs</span> <span class="free">ws</span> <span class="free">vs'</span> <span class="main">⟹</span>
  length <span class="free">vs</span> <span class="main">=</span> length <span class="free">vs'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">ws</span></span> <span class="quoted"><span class="free">vs'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> run_subs_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reach_subs_run_vD<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">vs</span> <span class="free">ws</span> <span class="free">vs'</span> <span class="main">⟹</span>
  <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">vs</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ys</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="bound">ys</span> <span class="main">(</span><span class="free">vs'</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">∧</span> length <span class="bound">ys</span> <span class="main">=</span> length <span class="free">ws</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">ws</span></span> <span class="quoted"><span class="free">vs'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">bs</span> <span class="skolem">bss</span> <span class="skolem">s''</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">ys</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">s</span> <span class="main">=</span> length <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">=</span> length <span class="skolem">bss</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_subs_run_lD<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tb</span></span> <span class="keyword2"><span class="keyword">where</span></span> tb_def<span class="main">:</span> <span class="quoted"><span class="quoted">"ru <span class="free">n</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">s''</span> <span class="main">!</span> <span class="free">i</span><span class="main">,</span> <span class="skolem">tb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> run_subs_vD<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ys_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ys_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tb_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> ys_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> tb_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reach_subs_runI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">phi</span><span class="main">.</span> <span class="bound">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="bound">phi</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span> length <span class="bound">ws</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> ru <span class="free">n</span> <span class="bound">v</span> <span class="main">≠</span> None"</span></span>
    <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="free">vs</span> <span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="free">e</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">e'</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> n_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> msize_regex <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>su <span class="free">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span>
    length <span class="bound">ws</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="bound">v</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">vs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">e'</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">have</span></span> e_init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="free">init_hd</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Nil<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> reach_sub.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>su <span class="free">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
    <span class="keyword1"><span class="command">using</span></span> collect_subfmlas_msize<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> Nil<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> run_subs_def Let_def Nil<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> e_init<span class="main"><span class="main">]</span></span> n_def
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> reach_sub.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">x_t</span></span> <span class="skolem"><span class="skolem">x_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> s'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="skolem">xs</span> <span class="skolem">s'</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="skolem">s'</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="skolem">x_t</span><span class="main">,</span> <span class="skolem">x_X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_sub_split_last<span class="main">[</span><span class="operator">OF</span> snoc<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> IH'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">phi</span><span class="main">.</span> <span class="bound">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="bound">phi</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span> length <span class="bound">ws</span> <span class="main">=</span> length <span class="skolem">xs</span> <span class="main">∧</span> ru <span class="free">n</span> <span class="bound">v</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">phi</span>
    <span class="keyword3"><span class="command">assume</span></span> lassm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="skolem">phi</span><span class="main">)</span> <span class="skolem">ws</span> <span class="skolem">v</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="free">n</span> <span class="skolem">v</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> lassm<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ws_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ws</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_cases<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="skolem">phi</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span> length <span class="bound">ws</span> <span class="main">=</span> length <span class="skolem">xs</span> <span class="main">∧</span> ru <span class="free">n</span> <span class="bound">v</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_split_last<span class="main">[</span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ws_snoc<span class="main"><span class="main">]</span></span><span class="main">]</span> ws_def<span class="main">(</span>2<span class="main">)</span> ws_snoc
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>map <span class="main">(</span>su <span class="free">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ws</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
    <span class="quoted"><span class="quoted">"run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">≠</span> None"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ s'_def n_def<span class="main">]</span> IH'
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="skolem"><span class="skolem">tb</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">v'</span><span class="main">,</span> <span class="skolem">tb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ws_def<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> reach' <span class="main">=</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> v'_def<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> len_v'_vs <span class="main">=</span> reach_subs_run_lD<span class="main">[</span><span class="operator">OF</span> reach'<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> run_v'_vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">v'</span> <span class="main">⟹</span> ru <span class="free">n</span> <span class="bound">x</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> lassm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">v'</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">v'</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lassm
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>su <span class="free">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">ys</span> <span class="main">(</span><span class="skolem">v'</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_subs_run_vD<span class="main">[</span><span class="operator">OF</span> reach' i_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> len_v'_vs<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> zs_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="main">(</span>collect_subfmlas <span class="free">r</span> <span class="main">[]</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">zs</span> <span class="skolem">z</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">zs</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="free">n</span> <span class="skolem">z</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>2<span class="main">)</span> i_def<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> len_v'_vs<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> z_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">v'</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_inj ys_def<span class="main">(</span>1<span class="main">)</span> zs_def<span class="main">(</span>1<span class="main">)</span> ys_def<span class="main">(</span>2<span class="main">)</span> zs_def<span class="main">(</span>2<span class="main">)</span> ws_def<span class="main">(</span>2<span class="main">)</span> i_def<span class="main">(</span>2<span class="main">)</span> len_v'_vs
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ru <span class="free">n</span> <span class="skolem">x</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> zs_def<span class="main">(</span>3<span class="main">)</span> z_def i_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"run_subs <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="skolem">v'</span> <span class="main">≠</span> None"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc<span class="main">(</span>4<span class="main">)</span> reach_subs_run_vD<span class="main">[</span><span class="operator">OF</span> reach'<span class="main">]</span> len_v'_vs
      collect_subfmlas_msize<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> run_subs_def Let_def n_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> v'_def<span class="main">]</span> ws_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reach_sub_takeWhile<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">r</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">s'</span> <span class="main">⟹</span> <span class="free">r</span> <span class="free">s'</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">s''</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">f</span> <span class="free">v</span> <span class="main">⟹</span>
  <span class="free">vs'</span> <span class="main">=</span> takeWhile <span class="free">f</span> <span class="free">vs</span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound">t'</span> <span class="bound">t''</span> <span class="bound">v'</span><span class="main">.</span> reach_sub <span class="free">r</span> <span class="free">s</span> <span class="free">vs'</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="free">r</span> <span class="bound">t'</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">t''</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">f</span> <span class="bound">v'</span> <span class="main">∧</span>
  reach_sub <span class="free">r</span> <span class="bound">t'</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="free">vs'</span><span class="main">)</span> <span class="free">vs</span><span class="main">)</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">vs'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vydra_complete_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="free">e0</span> <span class="free">vs</span> <span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="free">e</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">e'</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> prefix'<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="free">e</span> <span class="free">vs'</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="free">f</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">f'</span><span class="main">,</span> <span class="main">(</span><span class="free">t'</span><span class="main">,</span> <span class="free">X'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> e0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e0</span> <span class="main">=</span> <span class="free">init_hd</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> reach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">t'</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> FR_fmla <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="free">φ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> n_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> msize_fmla <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="free">n</span><span class="main">)</span> <span class="main">(</span>su <span class="free">n</span> <span class="free">φ</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span> length <span class="bound">ws</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> ru <span class="free">n</span> <span class="bound">v</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_ge prefix prefix' e0 reach
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">e'</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">vs'</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">f'</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quoted"><span class="free">X'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sub_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bool <span class="skolem">x</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Bool
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e0</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">e'</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">f'</span></span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="skolem">X'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_t</span></span> <span class="skolem"><span class="skolem">v_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v_t</span><span class="main">,</span> <span class="skolem">v_X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> reach' <span class="main">=</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> msize<span class="main">:</span> <span class="quoted"><span class="quoted">"msize_fmla <span class="main">(</span>Bool <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> v_t_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v_t</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_run_hd<span class="main">[</span><span class="operator">OF</span> reach' 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
        reach_sub_run_hd<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> v_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ets_v_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">v_t</span> <span class="main">+</span> FR_fmla <span class="main">(</span>Bool <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>8<span class="main">)</span> add_mono_comm<span class="main">[</span><span class="operator">OF</span> v_t_le<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"FR_fmla <span class="main">(</span>Bool <span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main">]</span> order.trans
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">cv</span></span> <span class="skolem"><span class="skolem">cv'</span></span> <span class="skolem"><span class="skolem">ctb</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="main">(</span>Bool <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ws</span> <span class="skolem">cv</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">cv</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">cv'</span><span class="main">,</span> <span class="skolem">ctb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> v_def<span class="main"><span class="main">]</span></span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>5<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span> ets_v_t 2<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> reach <span class="main">=</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tb</span></span> <span class="keyword2"><span class="keyword">where</span></span> cv_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cv</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span>VYDRA_Bool <span class="skolem">x</span> <span class="skolem">s''</span><span class="main">)</span><span class="main">,</span> <span class="skolem">tb</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vydra_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> msize ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach'<span class="main">]</span> ws_def<span class="main">(</span>3<span class="main">)</span> 2<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ws_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">cv'</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ws_def<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> cv_def<span class="main">]</span> 2<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reach ws_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">x</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Atom
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e0</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">e'</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">f'</span></span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="skolem">X'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_t</span></span> <span class="skolem"><span class="skolem">v_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v_t</span><span class="main">,</span> <span class="skolem">v_X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> reach' <span class="main">=</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> msize<span class="main">:</span> <span class="quoted"><span class="quoted">"msize_fmla <span class="main">(</span>Atom <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> v_t_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v_t</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_run_hd<span class="main">[</span><span class="operator">OF</span> reach' 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
        reach_sub_run_hd<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> v_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ets_v_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">v_t</span> <span class="main">+</span> FR_fmla <span class="main">(</span>Atom <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>8<span class="main">)</span> add_mono_comm<span class="main">[</span><span class="operator">OF</span> v_t_le<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"FR_fmla <span class="main">(</span>Atom <span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main">]</span> order.trans
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">cv</span></span> <span class="skolem"><span class="skolem">cv'</span></span> <span class="skolem"><span class="skolem">ctb</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="main">(</span>Atom <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ws</span> <span class="skolem">cv</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">cv</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">cv'</span><span class="main">,</span> <span class="skolem">ctb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> v_def<span class="main"><span class="main">]</span></span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>5<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span> ets_v_t 2<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> reach <span class="main">=</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tb</span></span> <span class="keyword2"><span class="keyword">where</span></span> cv_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cv</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span>VYDRA_Atom <span class="skolem">x</span> <span class="skolem">s''</span><span class="main">)</span><span class="main">,</span> <span class="skolem">tb</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vydra_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> msize ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach'<span class="main">]</span> ws_def<span class="main">(</span>3<span class="main">)</span> 2<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ws_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">cv'</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ws_def<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> cv_def<span class="main">]</span> 2<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reach ws_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> Neg<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> e0<span class="main">,</span> <span class="operator">OF</span> _ _ _ _ refl<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> msize<span class="main">:</span> <span class="quoted"><span class="quoted">"msize_fmla <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Neg<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Neg<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e0</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">e'</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">f'</span></span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="skolem">X'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> IH<span class="main">[</span><span class="operator">OF</span> reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> 1<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reach_sub.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_t</span></span> <span class="skolem"><span class="skolem">v_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v_t</span><span class="main">,</span> <span class="skolem">v_X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> reach' <span class="main">=</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> v_t_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v_t</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_run_hd<span class="main">[</span><span class="operator">OF</span> reach' 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
        reach_sub_run_hd<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> v_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ets_v_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">v_t</span> <span class="main">+</span> FR_fmla <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>8<span class="main">)</span> add_mono_comm<span class="main">[</span><span class="operator">OF</span> v_t_le<span class="main">]</span> order.trans
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">sv</span></span> <span class="skolem"><span class="skolem">sv'</span></span> <span class="skolem"><span class="skolem">stb</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">ys</span> <span class="skolem">sv</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">sv</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">sv'</span><span class="main">,</span> <span class="skolem">stb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IH<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> v_def<span class="main"><span class="main">]</span></span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>5<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> ets_v_t 2<span class="main">(</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">cv</span></span> <span class="skolem"><span class="skolem">cv'</span></span> <span class="skolem"><span class="skolem">ctb</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Neg <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ws</span> <span class="skolem">cv</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">cv</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">cv'</span><span class="main">,</span> <span class="skolem">ctb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> v_def<span class="main"><span class="main">]</span></span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>5<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span> ets_v_t 2<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> reach <span class="main">=</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ys_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tb</span></span> <span class="keyword2"><span class="keyword">where</span></span> cv_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cv</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span>VYDRA_Neg <span class="skolem">sv'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">tb</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vydra_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> msize ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach<span class="main">]</span> ws_def<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ws_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ys_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="skolem"><span class="skolem">va</span></span> <span class="keyword2"><span class="keyword">where</span></span> zs_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">zs</span> <span class="skolem">va</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">zs</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">va</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IH<span class="main">[</span><span class="operator">OF</span> reach_sub_app<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> v_def<span class="main"><span class="main">]</span></span><span class="main">]</span> 2<span class="main">(</span>8<span class="main">,</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> run_sv'<span class="main">:</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">sv'</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach zs_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> ws_def<span class="main">(</span>2<span class="main">)</span> ys_def<span class="main">(</span>2<span class="main">)</span> zs_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">cv'</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ws_def<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> cv_def<span class="main">]</span> run_sv' vydra_wf<span class="main">[</span><span class="operator">OF</span> Neg<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> reach<span class="main">]</span> 2<span class="main">(</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> ws_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bin <span class="skolem">n</span> <span class="skolem">op</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> msize<span class="main">:</span> <span class="quoted"><span class="quoted">"msize_fmla <span class="skolem">x1</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"msize_fmla <span class="skolem">x2</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Bin<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> Bin<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> e0<span class="main">,</span> <span class="operator">OF</span> _ _ _ _ refl<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> Bin<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> e0<span class="main">,</span> <span class="operator">OF</span> _ _ _ _ refl<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Bin<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e0</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">e'</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">f'</span></span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="skolem">X'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> FR_fmla <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> FR_fmla <span class="skolem">x2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>5<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mono order_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> IH1<span class="main">[</span><span class="operator">OF</span> reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        IH2<span class="main">[</span><span class="operator">OF</span> reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> 1<span class="main">(</span>6<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reach_sub.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ets_t'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> FR_fmla <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> FR_fmla <span class="skolem">x2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>8<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mono order_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_t</span></span> <span class="skolem"><span class="skolem">v_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v_t</span><span class="main">,</span> <span class="skolem">v_X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> reach' <span class="main">=</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> v_t_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v_t</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_run_hd<span class="main">[</span><span class="operator">OF</span> reach' 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
        reach_sub_run_hd<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> v_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ets_v_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">v_t</span> <span class="main">+</span> FR_fmla <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">v_t</span> <span class="main">+</span> FR_fmla <span class="skolem">x2</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">v_t</span> <span class="main">+</span> FR_fmla <span class="main">(</span>Bin <span class="skolem">op</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>8<span class="main">)</span> ets_t' add_mono_comm<span class="main">[</span><span class="operator">OF</span> v_t_le<span class="main">]</span> order.trans
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mono order_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys1</span></span> <span class="skolem"><span class="skolem">sv1</span></span> <span class="skolem"><span class="skolem">sv1'</span></span> <span class="skolem"><span class="skolem">stb1</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x1</span><span class="main">)</span> <span class="skolem">ys1</span> <span class="skolem">sv1</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ys1</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">sv1</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">sv1'</span><span class="main">,</span> <span class="skolem">stb1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IH1<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> v_def<span class="main"><span class="main">]</span></span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>5<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> ets_v_t 2<span class="main">(</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys2</span></span> <span class="skolem"><span class="skolem">sv2</span></span> <span class="skolem"><span class="skolem">sv2'</span></span> <span class="skolem"><span class="skolem">stb2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x2</span><span class="main">)</span> <span class="skolem">ys2</span> <span class="skolem">sv2</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ys2</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">sv2</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">sv2'</span><span class="main">,</span> <span class="skolem">stb2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IH2<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> v_def<span class="main"><span class="main">]</span></span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>5<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> ets_v_t 2<span class="main">(</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">cv</span></span> <span class="skolem"><span class="skolem">cv'</span></span> <span class="skolem"><span class="skolem">ctb</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Bin <span class="skolem">op</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ws</span> <span class="skolem">cv</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">cv</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">cv'</span><span class="main">,</span> <span class="skolem">ctb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> v_def<span class="main"><span class="main">]</span></span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>5<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span> ets_v_t 2<span class="main">(</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> reach1 <span class="main">=</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ys1_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> reach2 <span class="main">=</span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ys2_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tb</span></span> <span class="keyword2"><span class="keyword">where</span></span> cv_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cv</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span>VYDRA_Bin <span class="skolem">op</span> <span class="skolem">sv1'</span> <span class="skolem">sv2'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">tb</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vydra_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Bin<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach1<span class="main">]</span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach2<span class="main">]</span> ws_def<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ws_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ys1_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ys2_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zs1</span></span> <span class="skolem"><span class="skolem">va1</span></span> <span class="keyword2"><span class="keyword">where</span></span> zs1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x1</span><span class="main">)</span> <span class="skolem">zs1</span> <span class="skolem">va1</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">zs1</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">va1</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IH1<span class="main">[</span><span class="operator">OF</span> reach_sub_app<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> v_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
        ets_t' 2<span class="main">(</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zs2</span></span> <span class="skolem"><span class="skolem">va2</span></span> <span class="keyword2"><span class="keyword">where</span></span> zs2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">x2</span><span class="main">)</span> <span class="skolem">zs2</span> <span class="skolem">va2</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">zs2</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">va2</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IH2<span class="main">[</span><span class="operator">OF</span> reach_sub_app<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> v_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
        ets_t' 2<span class="main">(</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> run_sv'<span class="main">:</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">sv1'</span> <span class="main">≠</span> None"</span></span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span> <span class="skolem">sv2'</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach1 zs1_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> ws_def<span class="main">(</span>2<span class="main">)</span> ys1_def<span class="main">(</span>2<span class="main">)</span> zs1_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
        reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach2 zs2_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> ys2_def<span class="main">(</span>2<span class="main">)</span> zs2_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">cv'</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ws_def<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> cv_def<span class="main">]</span> run_sv' vydra_wf<span class="main">[</span><span class="operator">OF</span> msize<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> reach1<span class="main">]</span>
        vydra_wf<span class="main">[</span><span class="operator">OF</span> msize<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> reach2<span class="main">]</span> 2<span class="main">(</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> ws_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MatchP <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> msize_regex<span class="main">:</span> <span class="quoted"><span class="quoted">"msize_regex <span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchP<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bf<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_future_regex <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchP<span class="main">(</span>9<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">args</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">args</span> <span class="main">=</span> <span class="main">(</span>init_args <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span>
    NFA.delta' <span class="main">(</span>iarray_of_list <span class="main">(</span>build_nfa_impl <span class="skolem">r</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> state_cnt <span class="skolem">r</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>state_cnt <span class="skolem">r</span><span class="main">)</span><span class="main">,</span>
    NFA.accept' <span class="main">(</span>iarray_of_list <span class="main">(</span>build_nfa_impl <span class="skolem">r</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> state_cnt <span class="skolem">r</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>state_cnt <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>ru_t<span class="main">,</span> read_t<span class="main">)</span> <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">,</span> read_subs read<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> msize_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> msize_fmla <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_trans<span class="main">[</span><span class="operator">OF</span> collect_subfmlas_msize<span class="main">]</span> MatchP<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> MDL_window <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted">l_t0</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">args</span></span>
    <span class="keyword1"><span class="command">using</span></span> bs_sat<span class="main">[</span><span class="operator">OF</span> vydra_wf<span class="main">,</span> <span class="operator">OF</span> msize_sub<span class="main">]</span> run_read_subs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span> <span class="quoted">read</span><span class="main">]</span>
      read_run_subs<span class="main">[</span><span class="operator">of</span> <span class="quoted">read</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span><span class="main">]</span> run_read_Some<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> read_run_Some<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span>
      run_t_read<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> read_t_run<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> ru_t_tau bf
    <span class="keyword1"><span class="command">unfolding</span></span> args_def iarray_of_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l_sub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l_sub</span> <span class="main">=</span> map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> args' <span class="main">=</span> args_def<span class="main">[</span><span class="operator">unfolded</span> init_args.simps<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> run_args<span class="main">:</span> <span class="quoted"><span class="quoted">"w_run_t <span class="skolem">args</span> <span class="main">=</span> ru_t"</span></span> <span class="quoted"><span class="quoted">"w_run_sub <span class="skolem">args</span> <span class="main">=</span> run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">phi</span><span class="main">.</span> <span class="bound">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="bound">phi</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span>
    length <span class="bound">ws</span> <span class="main">=</span> length <span class="skolem">vs</span> <span class="main">∧</span> ru <span class="skolem">n</span> <span class="bound">v</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">phi</span>
    <span class="keyword3"><span class="command">assume</span></span> lassm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> FR_le<span class="main">:</span> <span class="quoted"><span class="quoted">"FR_fmla <span class="skolem">phi</span> <span class="main">≤</span> FR_fmla <span class="main">(</span>MatchP <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FR_collect_subfmlas<span class="main">[</span><span class="operator">OF</span> lassm<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ets_t'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> FR_fmla <span class="skolem">phi</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> MatchP<span class="main">(</span>8<span class="main">)</span> add_mono<span class="main">[</span><span class="operator">OF</span> FR_le<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> order.trans
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">phi</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span> length <span class="bound">ws</span> <span class="main">=</span> length <span class="skolem">vs</span> <span class="main">∧</span> ru <span class="skolem">n</span> <span class="bound">v</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> MatchP ets_t' bf_collect_subfmlas lassm msize_sub
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> subs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span> length <span class="bound">ws</span> <span class="main">=</span> length <span class="skolem">vs</span> <span class="main">∧</span>
    run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="bound">v</span> <span class="main">≠</span> None"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_subs_runI<span class="main">[</span><span class="operator">OF</span> sub MatchP<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> MatchP<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> msize_regex
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchP<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> subs
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e0</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">e'</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">X</span></span> <span class="quoted"><span class="skolem">vs'</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">f'</span></span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="skolem">X'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> init_window <span class="skolem">args</span> l_t0 <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> w_def' <span class="main">=</span> w_def<span class="main">[</span><span class="operator">unfolded</span> init_window.simps init_def<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ru_t l_t0 <span class="main">≠</span> None"</span></span> <span class="quoted"><span class="quoted">"run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="skolem">l_sub</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t0_def l_sub_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> reach_sub.cases <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"w_run_t <span class="skolem">args</span> <span class="main">(</span>w_tj <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> ru_t l_t0"</span></span>
      <span class="quoted"><span class="quoted">"w_run_sub <span class="skolem">args</span> <span class="main">(</span>w_sj <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="skolem">l_sub</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args_def w_def l_sub_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_mP <span class="skolem">I</span> <span class="skolem">w</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_eval_matchP<span class="main">[</span><span class="operator">OF</span> valid_init_matchP<span class="main"><span class="main">[</span></span><span class="operator">folded</span> w_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args' init_def w_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">va</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ys</span> <span class="skolem">va</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="skolem">va</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ys_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_cases<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">wp</span></span> <span class="keyword2"><span class="keyword">where</span></span> wp_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">zs</span> <span class="skolem">wp</span>"</span></span> <span class="quoted"><span class="quoted">"run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="skolem">wp</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">va</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_split_last<span class="main">[</span><span class="operator">OF</span> ys_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ys_snoc<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_t</span></span> <span class="skolem"><span class="skolem">v_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v_t</span><span class="main">,</span> <span class="skolem">v_X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">vb</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>MatchP <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ws</span> <span class="skolem">vb</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">vb</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> v_def<span class="main"><span class="main">]</span></span><span class="main">]</span> wp_def ys_snoc ys_def<span class="main">(</span>2<span class="main">)</span> 2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">tb</span></span> <span class="keyword2"><span class="keyword">where</span></span> vb_def<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">vb</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_MatchP <span class="skolem">I</span> <span class="main">(</span>iarray_of_list transs<span class="main">)</span> qf <span class="skolem">w</span><span class="main">,</span> <span class="skolem">tb</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vydra_wf<span class="main">[</span><span class="operator">OF</span> MatchP<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> MatchP<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span> ws_def<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qf_def transs_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> wf_vydra.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs_def<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_matchP <span class="skolem">I</span> l_t0 <span class="skolem">l_sub</span> <span class="skolem">xs</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vydra_wf<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> MatchP<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> ws_def<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> MatchP<span class="main"><span class="main"><span class="main">(</span></span></span>9<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">unfolded</span> vb_def<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args' l_sub_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> csj_va<span class="main">:</span> <span class="quoted"><span class="quoted">"w_sj <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">va</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> ys_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">folded</span> l_sub_def<span class="main">,</span>
        <span class="operator">OF</span> valid_window_matchP_reach_sj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xs_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> run_args<span class="main"><span class="main">]</span></span><span class="main">]</span>
        ws_def<span class="main">(</span>2<span class="main">)</span> ys_def<span class="main">(</span>2<span class="main">)</span> valid_window_matchP_len_rho<span class="main">[</span><span class="operator">OF</span> xs_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v_t</span></span> <span class="skolem"><span class="skolem">v_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v_t</span><span class="main">,</span> <span class="skolem">v_X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"w_tj <span class="skolem">w</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">e'</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach_event_t0_t<span class="main"><span class="main">[</span></span><span class="operator">OF</span> reach_sub_app<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">unfolded</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>5<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span>
        valid_window_matchP_reach_tj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xs_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> run_args<span class="main"><span class="main">]</span></span><span class="main">]</span>
        ws_def<span class="main">(</span>2<span class="main">)</span> valid_window_matchP_len_rho<span class="main">[</span><span class="operator">OF</span> xs_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ru_t <span class="main">(</span>w_tj <span class="skolem">w</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_mP <span class="skolem">I</span> <span class="skolem">w</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_eval_matchP<span class="main">[</span><span class="operator">OF</span> xs_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> csj_va l_sub_def<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">unfolded</span> run_args<span class="main">]</span> ys_def<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> csj_va
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="skolem"><span class="skolem">tb'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">vb</span> <span class="main">=</span> Some <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span><span class="skolem">w'</span><span class="main">,</span> <span class="skolem">tb'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">tb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> vb_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args' qf_def transs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span><span class="skolem">w'</span><span class="main">,</span> <span class="skolem">tb'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vydra_wf<span class="main">[</span><span class="operator">OF</span> MatchP<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> reach_sub_app<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> w'_def<span class="main"><span class="main">]</span></span> MatchP<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> w'_def<span class="main">]</span> ws_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MatchF <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> msize_regex<span class="main">:</span> <span class="quoted"><span class="quoted">"msize_regex <span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchF<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bf<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_future_regex <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchF<span class="main">(</span>9<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">args</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">args</span> <span class="main">=</span> <span class="main">(</span>init_args <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span>
    NFA.delta' <span class="main">(</span>iarray_of_list <span class="main">(</span>build_nfa_impl <span class="skolem">r</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> state_cnt <span class="skolem">r</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>state_cnt <span class="skolem">r</span><span class="main">)</span><span class="main">,</span>
    NFA.accept' <span class="main">(</span>iarray_of_list <span class="main">(</span>build_nfa_impl <span class="skolem">r</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> state_cnt <span class="skolem">r</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>state_cnt <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>ru_t<span class="main">,</span> read_t<span class="main">)</span> <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">,</span> read_subs read<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> msize_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> msize_fmla <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_trans<span class="main">[</span><span class="operator">OF</span> collect_subfmlas_msize<span class="main">]</span> MatchF<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> MDL_window <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted">l_t0</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">args</span></span>
    <span class="keyword1"><span class="command">using</span></span> bs_sat<span class="main">[</span><span class="operator">OF</span> vydra_wf<span class="main">,</span> <span class="operator">OF</span> msize_sub<span class="main">]</span> run_read_subs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span> <span class="quoted">read</span><span class="main">]</span>
      read_run_subs<span class="main">[</span><span class="operator">of</span> <span class="quoted">read</span> <span class="quoted"><span class="quoted">"ru <span class="skolem">n</span>"</span></span><span class="main">]</span> run_read_Some<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> read_run_Some<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span>
      run_t_read<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> read_t_run<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">run_hd</span></span><span class="main">]</span> ru_t_tau bf
    <span class="keyword1"><span class="command">unfolding</span></span> args_def iarray_of_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l_sub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l_sub</span> <span class="main">=</span> map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> args' <span class="main">=</span> args_def<span class="main">[</span><span class="operator">unfolded</span> init_args.simps<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> run_args<span class="main">:</span> <span class="quoted"><span class="quoted">"w_run_t <span class="skolem">args</span> <span class="main">=</span> ru_t"</span></span> <span class="quoted"><span class="quoted">"w_read_t <span class="skolem">args</span> <span class="main">=</span> read_t"</span></span> <span class="quoted"><span class="quoted">"w_run_sub <span class="skolem">args</span> <span class="main">=</span> run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"w_read_sub <span class="skolem">args</span> <span class="main">=</span> read_subs read"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> args_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> not_ets_tt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="skolem">t'</span><span class="main">,</span> <span class="skolem">X'</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">tt</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">tt</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> right <span class="skolem">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchF<span class="main">(</span>8<span class="main">)</span> add_mono<span class="main">[</span><span class="operator">OF</span> FR_pos<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">+</span> right <span class="skolem">I</span>"</span></span><span class="main">]</span> order.trans
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rho</span></span> <span class="keyword2"><span class="keyword">where</span></span> rho_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rho</span> <span class="main">=</span> takeWhile <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">tt</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">tt</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> right <span class="skolem">I</span><span class="main">)</span> <span class="skolem">vs'</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="skolem"><span class="skolem">g_t</span></span> <span class="skolem"><span class="skolem">g_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> g_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="skolem">e</span> <span class="skolem">rho</span> <span class="skolem">g</span>"</span></span>
    <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="skolem">g</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">rho</span><span class="main">)</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="skolem">g</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">g'</span><span class="main">,</span> <span class="main">(</span><span class="skolem">g_t</span><span class="main">,</span> <span class="skolem">g_X</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">g_t</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> right <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_sub_takeWhile<span class="main">[</span><span class="operator">OF</span> MatchF<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> not_ets_tt rho_def<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rho'</span></span> <span class="skolem"><span class="skolem">rho_last</span></span> <span class="keyword2"><span class="keyword">where</span></span> rho_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rho</span> <span class="main">=</span> <span class="skolem">rho'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">rho_last</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g_def<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> MatchF<span class="main">(</span>4<span class="main">)</span> right_I_add_mono
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rho</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reach_sub.cases<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rho_last_t</span></span> <span class="skolem"><span class="skolem">rho_last_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> rho_last_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rho_last</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rho_last_t</span><span class="main">,</span> <span class="skolem">rho_last_X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rho_last</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="free">run_hd</span> <span class="skolem">e</span> <span class="skolem">rho'</span> <span class="skolem">h</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="skolem">h</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">g</span><span class="main">,</span> <span class="main">(</span><span class="skolem">rho_last_t</span><span class="main">,</span> <span class="skolem">rho_last_X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_sub_split_last<span class="main">[</span><span class="operator">OF</span> g_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> rho_split rho_last_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rho_last_t</span><span class="main">,</span> <span class="skolem">rho_last_X</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">rho</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rho_split rho_last_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ets_rho_last_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rho_last_t</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> right <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_takeWhileD
    <span class="keyword1"><span class="command">unfolding</span></span> rho_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">note</span></span> reach_sub_eg <span class="main">=</span> reach_event_t<span class="main">[</span><span class="operator">OF</span> g_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> MatchF<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> g_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> reach_sub_e <span class="main">=</span> reach_event_t0_t<span class="main">[</span><span class="operator">OF</span> MatchF<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> MatchF<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> MatchF<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> reach_sub_t <span class="main">=</span> reach_sub_trans<span class="main">[</span><span class="operator">OF</span> reach_sub_e reach_sub_eg<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> reach_sub_init_vs_rho' <span class="main">=</span> reach_sub_trans<span class="main">[</span><span class="operator">OF</span> MatchF<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> MatchF<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> h_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">phi</span><span class="main">.</span> <span class="bound">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="bound">phi</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span>
    length <span class="bound">ws</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">rho'</span><span class="main">)</span> <span class="main">∧</span> ru <span class="skolem">n</span> <span class="bound">v</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">phi</span>
    <span class="keyword3"><span class="command">assume</span></span> lassm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">phi</span> <span class="main">∈</span> set <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> FR_le<span class="main">:</span> <span class="quoted"><span class="quoted">"FR_fmla <span class="skolem">phi</span> <span class="main">≤</span> FR_regex <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FR_collect_subfmlas<span class="main">[</span><span class="operator">OF</span> lassm<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ets_t'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">rho_last_t</span> <span class="main">+</span> FR_fmla <span class="skolem">phi</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> MatchF<span class="main">(</span>8<span class="main">)</span> order.trans add_mono<span class="main">[</span><span class="operator">OF</span> FR_le<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">rho_last_t</span></span><span class="main">]</span>
        add_mono<span class="main">[</span><span class="operator">OF</span> ets_rho_last_t<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"FR_regex <span class="skolem">r</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> FR_fmla.simps add.assoc
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute group_cancel.add1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>su <span class="skolem">n</span> <span class="skolem">phi</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span> length <span class="bound">ws</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">rho'</span><span class="main">)</span> <span class="main">∧</span> ru <span class="skolem">n</span> <span class="bound">v</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> MatchF<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> MatchF<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">OF</span> lassm msize_sub<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lassm<span class="main"><span class="main">]</span></span> reach_sub_init_vs_rho'
        h_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> reach_sub.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> h_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> g_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> MatchF<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> refl ets_t'<span class="main">]</span>
        bf_collect_subfmlas<span class="main">[</span><span class="operator">OF</span> bf lassm<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> subs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ws</span> <span class="bound">v</span><span class="main">.</span> reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="bound">ws</span> <span class="bound">v</span> <span class="main">∧</span>
  length <span class="bound">ws</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">rho</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_subs_runI<span class="main">[</span><span class="operator">OF</span> sub reach_sub_init_vs_rho' h_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> msize_regex<span class="main">]</span> reach_sub_app
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rho_split<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> MatchF<span class="main">(</span>3<span class="main">,</span>7<span class="main">)</span> reach_sub_e reach_sub_t subs g_def<span class="main">(</span>4<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">e0</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">e'</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">g'</span></span> <span class="quoted"><span class="skolem">g_t</span></span> <span class="quoted"><span class="skolem">rho</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> l_t0_def<span class="main">:</span> <span class="quoted"><span class="quoted">"l_t0 <span class="main">=</span> Some <span class="main">(</span><span class="skolem">e'</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> reach_sub.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> read_l_t0<span class="main">:</span> <span class="quoted"><span class="quoted">"read_t l_t0 <span class="main">=</span> Some <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> l_t0_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> read_tj'''<span class="main">:</span> <span class="quoted"><span class="quoted">"read_t <span class="main">(</span>Some <span class="main">(</span><span class="skolem">g'</span><span class="main">,</span> <span class="skolem">g_t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">g_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">sj'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ws</span> <span class="skolem">sj'''</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="skolem">rho</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rho'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rho'</span> <span class="main">=</span> zip <span class="main">(</span>map fst <span class="skolem">rho</span><span class="main">)</span> <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> reach_sub_r_t<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub ru_t l_t0 <span class="main">(</span>map fst <span class="skolem">rho'</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="skolem">g'</span><span class="main">,</span> <span class="skolem">g_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> ws_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> rho'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> reach_sub_run_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">rho'</span><span class="main">)</span> <span class="skolem">sj'''</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ws_def
      <span class="keyword1"><span class="command">unfolding</span></span> rho'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> init_window <span class="skolem">args</span> l_t0 <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> w_def' <span class="main">=</span> w_def<span class="main">[</span><span class="operator">unfolded</span> init_window.simps init_def<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> w_tj_sj<span class="main">:</span> <span class="quoted"><span class="quoted">"w_ti <span class="skolem">w</span> <span class="main">=</span> l_t0"</span></span> <span class="quoted"><span class="quoted">"w_tj <span class="skolem">w</span> <span class="main">=</span> l_t0"</span></span> <span class="quoted"><span class="quoted">"w_sj <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">l_sub</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> w_def l_sub_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_mF <span class="skolem">I</span> <span class="skolem">w</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_eval_matchF_complete<span class="main">[</span><span class="operator">OF</span> valid_init_matchF<span class="main"><span class="main">[</span></span><span class="operator">folded</span> w_def<span class="main"><span class="main">]</span></span><span class="main">,</span>
          <span class="operator">unfolded</span> run_args w_tj_sj<span class="main">,</span> <span class="operator">OF</span> reach_sub_r_t reach_sub_run_sub<span class="main"><span class="main">[</span></span><span class="operator">folded</span> l_sub_def<span class="main"><span class="main">]</span></span>
          read_l_t0 read_tj''' 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> w_def args' init_def Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach_sub.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">v</span> <span class="skolem">vs</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> reach_sub_r_l_t0<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub ru_t l_t0 <span class="main">(</span>map fst <span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span>fst <span class="skolem">v</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="skolem">e'</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">sj'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ys</span> <span class="skolem">sj'''</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">=</span> length <span class="main">(</span><span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">rho</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>7<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_split</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_split<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub ru_t l_t0 <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">t_split</span>"</span></span>
      <span class="quoted"><span class="quoted">"ru_t <span class="skolem">t_split</span> <span class="main">=</span> Some <span class="main">(</span>Some <span class="main">(</span><span class="skolem">e'</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> fst <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_split_last<span class="main">[</span><span class="operator">OF</span> reach_sub_r_l_t0<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t_e</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_split_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t_split</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">t_e</span><span class="main">,</span> fst <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> t_split<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t_split</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> reach_sub_r_l_t0'<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub ru_t l_t0 <span class="main">(</span>map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">rho</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="skolem">g'</span><span class="main">,</span> <span class="skolem">g_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>6<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fst_v_t<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ru_t_event<span class="main">[</span><span class="operator">OF</span> t_split<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> refl t_split<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> ru_t_event<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> refl<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> t_split_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ru_t <span class="main">(</span>Some <span class="main">(</span><span class="skolem">e'</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> not_ets_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">g_t</span> <span class="main">≤</span> <span class="main">(</span>fst <span class="skolem">v</span><span class="main">)</span> <span class="main">+</span> right <span class="skolem">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>8<span class="main">)</span> fst_v_t add_mono<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"right <span class="skolem">I</span>"</span></span><span class="main">]</span> order.trans
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">cv</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>su <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>MatchF <span class="skolem">I</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ws</span> <span class="skolem">cv</span>"</span></span>
      <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span> <span class="quoted"><span class="quoted">"ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">cv</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> t_split<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> t_split_def<span class="main"><span class="main">]</span></span> reach_sub_r_l_t0' _ not_ets_gt<span class="main">]</span> 2<span class="main">(</span>7<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ctb</span></span> <span class="keyword2"><span class="keyword">where</span></span> cv_def<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">cv</span> <span class="main">=</span> VYDRA <span class="main">(</span>Some <span class="main">(</span>VYDRA_MatchF <span class="skolem">I</span> <span class="main">(</span>iarray_of_list transs<span class="main">)</span> qf <span class="skolem">w</span><span class="main">,</span> <span class="skolem">ctb</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"valid_matchF <span class="skolem">I</span> l_t0 <span class="skolem">l_sub</span> <span class="skolem">xs</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_vydra.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vydra_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MatchF<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> MatchF<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> ws_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> l_sub_def qf_def transs_def args'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cij_def<span class="main">:</span> <span class="quoted"><span class="quoted">"w_i <span class="skolem">w</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"w_j <span class="skolem">w</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cv_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_window_matchF_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> reach_cti<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub ru_t l_t0 <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>w_ti <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"reach_sub ru_t <span class="main">(</span>w_ti <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>w_tj <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"w_ti <span class="skolem">w</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">e'</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cv_def<span class="main">(</span>2<span class="main">)</span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> _ 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_window_matchF_def run_args<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> read_cti<span class="main">:</span> <span class="quoted"><span class="quoted">"read_t <span class="main">(</span>w_ti <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> reach_cti
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> reach_ctj<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub ru_t l_t0 <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span> <span class="main">(</span>w_tj <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cv_def<span class="main">(</span>2<span class="main">)</span> reach_sub_trans
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_window_matchF_def run_args<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> reach_csj<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>su <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>collect_subfmlas <span class="skolem">r</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span> <span class="main">(</span>w_sj <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cv_def<span class="main">(</span>2<span class="main">)</span> reach_sub_trans
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_window_matchF_def run_args l_sub_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> len_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">rho</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> contr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>length <span class="skolem">xs</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">rho</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> ci_lt_cj<span class="main">:</span> <span class="quoted"><span class="quoted">"w_i <span class="skolem">w</span> <span class="main">&lt;</span> w_j <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> contr
        <span class="keyword1"><span class="command">unfolding</span></span> cij_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ts_at_xs_ci<span class="main">:</span> <span class="quoted"><span class="quoted">"ts_at <span class="skolem">xs</span> <span class="main">(</span>w_i <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> reach_sub.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> reach_cti<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> cij_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> contr nth_via_drop
        <span class="keyword1"><span class="command">unfolding</span></span> cij_def reach_cti
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ts_at_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> reach_r_t_g_ctj<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub ru_t <span class="main">(</span>Some <span class="main">(</span><span class="skolem">g'</span><span class="main">,</span> <span class="skolem">g_t</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">rho</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>w_tj <span class="skolem">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reach_sub_split'<span class="main">[</span><span class="operator">OF</span> reach_ctj<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">rho</span><span class="main">)</span>"</span></span><span class="main">]</span> contr
          reach_sub_inj<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ts_at_xs_gi<span class="main">:</span> <span class="quoted"><span class="quoted">"ts_at <span class="skolem">xs</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">rho</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g_t</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> reach_sub.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> reach_r_t_g_ctj<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> contr nth_via_drop
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ts_at_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> ts_at_xs_ci ts_at_xs_gi 2<span class="main">(</span>8<span class="main">)</span> cij_def contr cv_def<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_window_matchF_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rho'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rho'</span> <span class="main">=</span> zip <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> map fst <span class="skolem">rho</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reach_sub ru_t <span class="main">(</span>w_tj <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">v</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> map fst <span class="skolem">rho</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>Some <span class="main">(</span><span class="skolem">g'</span><span class="main">,</span> <span class="skolem">g_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len_xs reach_sub_split'<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span>"</span></span><span class="main">]</span> reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach_ctj<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> reach_ctj_rho'<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub ru_t <span class="main">(</span>w_tj <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">rho'</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="skolem">g'</span><span class="main">,</span> <span class="skolem">g_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len_xs ys_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> rho'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>w_sj <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">)</span> <span class="skolem">sj'''</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len_xs reach_sub_split'<span class="main">[</span><span class="operator">OF</span> ys_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span>"</span></span><span class="main">]</span> ys_def<span class="main">(</span>2<span class="main">)</span>
        reach_sub_inj<span class="main">[</span><span class="operator">OF</span> reach_csj<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> reach_sub_csj_rho'<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>run_subs <span class="main">(</span>ru <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>w_sj <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">rho'</span><span class="main">)</span> <span class="skolem">sj'''</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len_xs ys_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> rho'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> read_g<span class="main">:</span> <span class="quoted"><span class="quoted">"read_t <span class="main">(</span>Some <span class="main">(</span><span class="skolem">g'</span><span class="main">,</span> <span class="skolem">g_t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">g_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> eval_not_None<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_mF <span class="skolem">I</span> <span class="skolem">w</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_eval_matchF_complete<span class="main">[</span><span class="operator">OF</span> cv_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> l_sub_def<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">unfolded</span> run_args<span class="main">,</span> <span class="operator">OF</span>
        reach_ctj_rho' reach_sub_csj_rho' read_cti read_g 2<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="skolem"><span class="skolem">tb'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">cv</span> <span class="main">=</span> Some <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span><span class="skolem">w'</span><span class="main">,</span> <span class="skolem">tb'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ctb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cv_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qf_def transs_def args'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ru <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>VYDRA <span class="main">(</span>Some <span class="main">(</span><span class="skolem">w'</span><span class="main">,</span> <span class="skolem">tb'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vydra_wf<span class="main">[</span><span class="operator">OF</span> _ reach_sub_app<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> w'_def<span class="main"><span class="main">]</span></span> MatchF<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> reach_sub_app<span class="main">[</span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> w'_def<span class="main">]</span> ws_def<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Prev <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sub_prev<span class="main">:</span> <span class="quoted"><span class="quoted">"su <span class="skolem">n</span> <span class="main">(</span>Prev <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span> <span class="main">=</span> su <span class="skolem">n</span> <span class="main">(</span>PossiblyP <span class="skolem">phi</span> <span class="skolem">I</span> Wild<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> FR_fmla <span class="main">(</span>PossiblyP <span class="skolem">phi</span> <span class="skolem">I</span> Wild<span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="main">(</span>PossiblyP <span class="skolem">phi</span> <span class="skolem">I</span> Wild<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Prev<span class="main">(</span>7<span class="main">,</span>8<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def FR_pos<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add_mono order.trans<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Prev<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Prev<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> prems<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sub_prev <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sub_next<span class="main">:</span> <span class="quoted"><span class="quoted">"su <span class="skolem">n</span> <span class="main">(</span>Next <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span> <span class="main">=</span> su <span class="skolem">n</span> <span class="main">(</span>PossiblyF Wild <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> FR_fmla <span class="main">(</span>PossiblyF Wild <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="main">(</span>PossiblyF Wild <span class="skolem">I</span> <span class="skolem">phi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Next<span class="main">(</span>7<span class="main">,</span>8<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def FR_pos<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup_absorb2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Next<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Next<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> prems<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sub_next <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Since <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">phi</span> <span class="skolem">psi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sub_since<span class="main">:</span> <span class="quoted"><span class="quoted">"su <span class="skolem">n</span> <span class="main">(</span>Since <span class="skolem">phi</span> <span class="skolem">I</span> <span class="skolem">psi</span><span class="main">)</span> <span class="main">=</span> su <span class="skolem">n</span> <span class="main">(</span>PossiblyP <span class="skolem">psi</span> <span class="skolem">I</span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="skolem">phi</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def BaseP_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> FR_fmla <span class="main">(</span>PossiblyP <span class="skolem">psi</span> <span class="skolem">I</span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="skolem">phi</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="main">(</span>PossiblyP <span class="skolem">psi</span> <span class="skolem">I</span> <span class="main">(</span>Star <span class="main">(</span>BaseP <span class="skolem">phi</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Since<span class="main">(</span>7<span class="main">,</span>8<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyP_def BaseP_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> FR_pos<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup.commute sup.order_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Since<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Since<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> prems<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sub_since <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until <span class="skolem">n</span> <span class="skolem">I</span> <span class="skolem">phi</span> <span class="skolem">psi</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sub_until<span class="main">:</span> <span class="quoted"><span class="quoted">"su <span class="skolem">n</span> <span class="main">(</span>Until <span class="skolem">phi</span> <span class="skolem">I</span> <span class="skolem">psi</span><span class="main">)</span> <span class="main">=</span> su <span class="skolem">n</span> <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="skolem">phi</span><span class="main">)</span><span class="main">)</span> <span class="skolem">I</span> <span class="skolem">psi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def BaseF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">t'</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">+</span> FR_fmla <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="skolem">phi</span><span class="main">)</span><span class="main">)</span> <span class="skolem">I</span> <span class="skolem">psi</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="main">(</span>PossiblyF <span class="main">(</span>Star <span class="main">(</span>BaseF <span class="skolem">phi</span><span class="main">)</span><span class="main">)</span> <span class="skolem">I</span> <span class="skolem">psi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Until<span class="main">(</span>7<span class="main">,</span>8<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PossiblyF_def BaseF_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> FR_pos<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup.orderE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Until<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Until<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> prems<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sub_until <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ru'</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> ru <span class="main">(</span>msize_fmla <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">su'</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> su <span class="main">(</span>msize_fmla <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vydra_aux_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>ru' <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>su' <span class="free">φ</span><span class="main">)</span> <span class="free">n</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"ru' <span class="free">φ</span> <span class="free">v</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free">n</span><span class="main">,</span> sat <span class="free">φ</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vydra_wf<span class="main">[</span><span class="operator">OF</span> order.refl<span class="main">]</span> reaches_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ru'_def su'_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> wf_vydraD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vydra_aux_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"reaches <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="free">n</span> <span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="free">e</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">e'</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> prefix'<span class="main">:</span> <span class="quoted"><span class="quoted">"reaches <span class="free">run_hd</span> <span class="free">e</span> <span class="free">n'</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="free">f</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">f'</span><span class="main">,</span> <span class="main">(</span><span class="free">t'</span><span class="main">,</span> <span class="free">X'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> reach<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">t'</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> FR_fmla <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> reaches <span class="main">(</span>ru' <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>su' <span class="free">φ</span><span class="main">)</span> <span class="free">n</span> <span class="bound">v</span> <span class="main">∧</span> ru' <span class="free">φ</span> <span class="bound">v</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">v'</span><span class="main">,</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free">n</span><span class="main">,</span> sat <span class="free">φ</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span>ru' <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>su' <span class="free">φ</span><span class="main">)</span> <span class="skolem">ws</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"ru' <span class="free">φ</span> <span class="skolem">v</span> <span class="main">≠</span> None"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vydra_complete_sub<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> refl reach<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> reaches_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      reaches_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> ru'_def su'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> tb_def<span class="main">:</span> <span class="quoted"><span class="quoted">"ru' <span class="free">φ</span> <span class="skolem">v</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">v'</span><span class="main">,</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ws_def<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> reach_sub_n<span class="main">[</span><span class="operator">OF</span> ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> ws_def<span class="main">(</span>2<span class="main">)</span> tb_def
      wf_vydraD<span class="main">[</span><span class="operator">OF</span> vydra_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order.refl ws_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ru'_def su'_def<span class="main"><span class="main">]</span></span> reach<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ru'_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_option_apfst_idle<span class="main">:</span> <span class="quoted"><span class="quoted">"map_option <span class="main">(</span>apfst snd<span class="main">)</span> <span class="main">(</span>map_option <span class="main">(</span>apfst <span class="main">(</span>Pair <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vydra_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>run_vydra <span class="free">run_hd</span><span class="main">)</span> <span class="main">(</span>init_vydra <span class="free">init_hd</span> <span class="free">run_hd</span> <span class="free">φ</span><span class="main">)</span> <span class="free">n</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"run_vydra <span class="free">run_hd</span> <span class="free">v</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free">n</span><span class="main">,</span> sat <span class="free">φ</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fst_v<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="free">v</span> <span class="main">=</span> msize_fmla <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reaches_invar<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_vydra_def run_vydra_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>ru' <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>su' <span class="free">φ</span><span class="main">)</span> <span class="free">n</span> <span class="main">(</span>snd <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reaches_cong<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?P</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> msize_fmla <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?g</span><span class="main"><span class="main">=</span></span><span class="quoted">snd</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_vydra_def run_vydra_def ru'_def su'_def map_option_apfst_idle <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sub.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> vydra_aux_sound<span class="main">[</span><span class="operator">OF</span> _ _ assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> fst_v
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> run_vydra_def ru'_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vydra_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"reaches <span class="free">run_hd</span> <span class="free">init_hd</span> <span class="free">n</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ss</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> prefix'<span class="main">:</span> <span class="quoted"><span class="quoted">"reaches <span class="free">run_hd</span> <span class="free">s</span> <span class="free">n'</span> <span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">run_hd</span> <span class="free">s'</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">ss'</span><span class="main">,</span> <span class="main">(</span><span class="free">t'</span><span class="main">,</span> <span class="free">X'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> reach<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_future_fmla <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">t'</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> FR_fmla <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> reaches <span class="main">(</span>run_vydra <span class="free">run_hd</span><span class="main">)</span> <span class="main">(</span>init_vydra <span class="free">init_hd</span> <span class="free">run_hd</span> <span class="free">φ</span><span class="main">)</span> <span class="free">n</span> <span class="bound">v</span> <span class="main">∧</span> run_vydra <span class="free">run_hd</span> <span class="bound">v</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">v'</span><span class="main">,</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free">n</span><span class="main">,</span> sat <span class="free">φ</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> wits<span class="main">:</span> <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>ru' <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>su' <span class="free">φ</span><span class="main">)</span> <span class="free">n</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"ru' <span class="free">φ</span> <span class="skolem">v</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">v'</span><span class="main">,</span> τ <span class="free">σ</span> <span class="free">n</span><span class="main">,</span> sat <span class="free">φ</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vydra_aux_complete<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> reach<span class="main">:</span> <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>run_vydra <span class="free">run_hd</span><span class="main">)</span> <span class="main">(</span>init_vydra <span class="free">init_hd</span> <span class="free">run_hd</span> <span class="free">φ</span><span class="main">)</span> <span class="free">n</span> <span class="main">(</span>msize_fmla <span class="free">φ</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reaches_cong<span class="main">[</span><span class="operator">OF</span> wits<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?P</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?f'</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"run_vydra <span class="free">run_hd</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?g</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Pair <span class="main">(</span>msize_fmla <span class="free">φ</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_vydra_def run_vydra_def ru'_def su'_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sub.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>msize_fmla <span class="free"><span class="free">φ</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">v</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>msize_fmla <span class="free"><span class="free">φ</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">v'</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> run_vydra_def wits<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ru'_def<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reach<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> MDL
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reach_elem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reaches <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> Some <span class="main">(</span>Suc <span class="bound">i</span><span class="main">,</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="bound">i</span><span class="main">,</span> Γ <span class="free">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="free">n</span> <span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs_def<span class="main">:</span> <span class="quoted"><span class="quoted">"reach_sub <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> Some <span class="main">(</span>Suc <span class="bound">i</span><span class="main">,</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="bound">i</span><span class="main">,</span> Γ <span class="free">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="skolem">vs</span> <span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reaches_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">=</span> length <span class="skolem">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vs_def<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="skolem">vs</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reach_sub_rev_induct<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> vs_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> default_vydra<span class="main">:</span> VYDRA_MDL <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> Some <span class="main">(</span>Suc <span class="bound">i</span><span class="main">,</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="bound">i</span><span class="main">,</span> Γ <span class="free">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reach_elem
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>